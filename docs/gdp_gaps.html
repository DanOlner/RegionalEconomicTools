<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>UK regional economics tools and analysis in R - GDP/GVA regional gaps in the UK</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">UK regional economics tools and analysis in R</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./gdp_gaps.html">GDP and GVA</a></li><li class="breadcrumb-item"><a href="./gdp_gaps.html">GDP/GVA regional gaps in the UK</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">GDP and GVA</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gdp_gaps.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">GDP/GVA regional gaps in the UK</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./beattyfothergill.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Beatty &amp; Fothergill on productivity: viz</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Sectors</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sector_locationquotients_and_proportions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">UK sectors: LQs &amp; proportion plots</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#identifying-regional-gaps-in-gvagdp-in-the-uk" id="toc-identifying-regional-gaps-in-gvagdp-in-the-uk" class="nav-link active" data-scroll-target="#identifying-regional-gaps-in-gvagdp-in-the-uk">Identifying regional gaps in GVA/GDP in the UK</a></li>
  <li><a href="#finding-weighted-averages-for-per-hour-productivity" id="toc-finding-weighted-averages-for-per-hour-productivity" class="nav-link" data-scroll-target="#finding-weighted-averages-for-per-hour-productivity">Finding weighted averages for per hour productivity</a></li>
  <li><a href="#repeat-for-sheffield-vs-bdr" id="toc-repeat-for-sheffield-vs-bdr" class="nav-link" data-scroll-target="#repeat-for-sheffield-vs-bdr">Repeat for Sheffield vs BDR</a></li>
  <li><a href="#gva-per-hour-worked-gap-over-time" id="toc-gva-per-hour-worked-gap-over-time" class="nav-link" data-scroll-target="#gva-per-hour-worked-gap-over-time">GVA per hour worked: gap over time</a></li>
  <li><a href="#repeat-for-itl3" id="toc-repeat-for-itl3" class="nav-link" data-scroll-target="#repeat-for-itl3">Repeat for ITL3</a></li>
  <li><a href="#compare-places-using-gva-per-capita" id="toc-compare-places-using-gva-per-capita" class="nav-link" data-scroll-target="#compare-places-using-gva-per-capita">Compare places using GVA per capita</a></li>
  <li><a href="#proportion-diffs-for-itl2-gva-per-capita" id="toc-proportion-diffs-for-itl2-gva-per-capita" class="nav-link" data-scroll-target="#proportion-diffs-for-itl2-gva-per-capita">PROPORTION DIFFS FOR ITL2 GVA PER CAPITA</a></li>
  <li><a href="#repeat-per-capita-for-itl3" id="toc-repeat-per-capita-for-itl3" class="nav-link" data-scroll-target="#repeat-per-capita-for-itl3">REPEAT PER CAPITA FOR ITL3</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">GDP/GVA regional gaps in the UK</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="identifying-regional-gaps-in-gvagdp-in-the-uk" class="level2">
<h2 class="anchored" data-anchor-id="identifying-regional-gaps-in-gvagdp-in-the-uk">Identifying regional gaps in GVA/GDP in the UK</h2>
<p>Regional GVA/GDP data can be framed in many different ways. <a href="beattyfothergill.html">Take a look at</a> the page examining data from Beatty &amp; Fothergill’s work on this. If, for example, we want to understand the impact that inactivity or unemployment has on regional output, GVA per head of population won’t directly allow that (though it will be affecting differences between regions strongly).</p>
<p>Here, we’ll dig into some of the official data sources to examine what regional gaps in output appear, and how they compare to national and other larger-region averages.</p>
<p>Let’s start with one of the most common measures of regional productivity, <strong>GVA per hour worked</strong>. Information on data sources is in the code comments, but note that the hourly work data comes from the Labour Force Survey (see ‘measuring the data’ <a href="https://www.ons.gov.uk/economy/economicoutputandproductivity/productivitymeasures/bulletins/regionallabourproductivityincludingindustrybyregionuk/latest">here at ONS</a>). ONS say in their <a href="https://www.ons.gov.uk/employmentandlabourmarket/peopleinwork/labourproductivity/articles/regionalandsubregionalproductivityintheuk/june2023">June 2023 analysis of this data</a>:</p>
<blockquote class="blockquote">
<p>“Output per hour worked is the preferred measure of labour productivity, as hours worked are a more precise measure of labour input than jobs.”</p>
</blockquote>
<p>First, the libraries we’ll use (and setting scipen to avoid any scientific notation):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then load in the data for both ITL2 and ITL3 regions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ONS link to the Excel sheets: https://www.ons.gov.uk/economy/grossdomesticproductgdp/datasets/regionalgrossdomesticproductallnutslevelregions</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Data folder name of downloaded Excel sheets (from which the CSVs below have been exported)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#itlproductivity.xlsx</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>perhourworked <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/Table A4 Current Price unsmoothed GVA B per hour worked £ ITL2 and ITL3 subregions 2004 to 2021.csv'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(<span class="at">ITL =</span> <span class="st">`</span><span class="at">ITL level</span><span class="st">`</span>, <span class="at">ITLcode =</span> <span class="st">`</span><span class="at">ITL code</span><span class="st">`</span>, <span class="at">region =</span> <span class="st">`</span><span class="at">Region name</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITL <span class="sc">==</span> <span class="st">'ITL2'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">2004</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2021</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">'year'</span>, <span class="at">values_to =</span> <span class="st">'gva'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Repeat for ITL3</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>perhourworked.itl3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/Table A4 Current Price unsmoothed GVA B per hour worked £ ITL2 and ITL3 subregions 2004 to 2021.csv'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ITL =</span> <span class="st">`</span><span class="at">ITL level</span><span class="st">`</span>, <span class="at">ITLcode =</span> <span class="st">`</span><span class="at">ITL code</span><span class="st">`</span>, <span class="at">region =</span> <span class="st">`</span><span class="at">Region name</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITL <span class="sc">==</span> <span class="st">'ITL3'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">2004</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2021</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">'year'</span>, <span class="at">values_to =</span> <span class="st">'gva'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As the file names say, this is GVA per hour worked in <strong>current prices</strong>. That is, it’s the actual money amount for that specific ‘current’ year (2004 to 2021 in this data) - so it’s not inflation adjusted.</p>
<p>GVA/GDP data comes in either <strong>current prices</strong> (CP) or <strong>chained volume</strong> (CV) numbers. CV data has been <em>inflation-adjusted</em> so that change over time can be looked at - but the adjustment is done for each region separately, meaning that the difference in scale <em>between places</em> will be slightly off. (You can check this in e.g.&nbsp;the sector data by summing the CV values for regions and noting that it does <strong>not</strong> match the total for the larger geographies they’re a part of.)</p>
<p>In practice, this means it’s best to use <strong>current prices data to compare between places</strong> and <strong>chained volume / inflation adjusted numbers to look at how specific places’ GVA/GDP changes over time.</strong></p>
<p>However, it is possible to examine change over time in the current prices data if we just examine <strong>relative change</strong>, either in how proportions change or - as the next code block does - in how the rank position of places changes.</p>
<p>This block:</p>
<ul>
<li>Finds rank position of all places over time</li>
<li>Takes a moving 3 year average of that rank to smooth a bit</li>
<li>Labels different parts of the UK - North, South, London, South apart from London</li>
<li>Makes an interactive plot of the rank change over time (comparing the years after coalition govt and most recent years before COVID) with South Yorkshire highlighted</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Rank to see which ITL2 changed position the most</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>perhourworked <span class="ot">&lt;-</span> perhourworked <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(gva))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#3 year smoothing</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>perhourworked <span class="ot">&lt;-</span> perhourworked <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">movingav =</span> <span class="fu">rollapply</span>(gva,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank_movingav =</span> <span class="fu">rollapply</span>(rank,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank_movingav_7yr =</span> <span class="fu">rollapply</span>(rank,<span class="dv">7</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Picking out England and North etc...</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Via https://github.com/DanOlner/regionalGVAbyindustry</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Northern England</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>north <span class="ot">&lt;-</span> perhourworked<span class="sc">$</span>region[<span class="fu">grepl</span>(<span class="st">'Greater Manc|Merseyside|West Y|Cumbria|Cheshire|Lancashire|East Y|North Y|Tees|Northumb|South Y'</span>, perhourworked<span class="sc">$</span>region, <span class="at">ignore.case =</span> T)] <span class="sc">%&gt;%</span> unique</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">#South England</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>south <span class="ot">&lt;-</span> perhourworked<span class="sc">$</span>region[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">'Greater Manc|Merseyside|West Y|Cumbria|Cheshire|Lancashire|East Y|North Y|Tees|Northumb|South Y|Scot|Highl|Wales|Ireland'</span>, perhourworked<span class="sc">$</span>region, <span class="at">ignore.case =</span> T)] <span class="sc">%&gt;%</span> unique</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">#South minus London</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>south.minus.london <span class="ot">&lt;-</span> south[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">'london'</span>,south,<span class="at">ignore.case =</span> T)]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co">#England!</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>england <span class="ot">&lt;-</span> <span class="fu">c</span>(north,south)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co">#England minus London</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>england.minus.london <span class="ot">&lt;-</span> england[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">'london'</span>,england,<span class="at">ignore.case =</span> T)]</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co">#UK minus London</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>uk.minus.london <span class="ot">&lt;-</span> perhourworked<span class="sc">$</span>region[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">'london'</span>,perhourworked<span class="sc">$</span>region,<span class="at">ignore.case =</span> T)] <span class="sc">%&gt;%</span> unique</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co">#Add those regions into the per hour worked data</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>perhourworked <span class="ot">&lt;-</span> perhourworked <span class="sc">%&gt;%</span> </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ns_england_restofUK =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">%in%</span> north <span class="sc">~</span> <span class="st">'North England'</span>,</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">%in%</span> south <span class="sc">~</span> <span class="st">'South Eng (inc. London)'</span>,</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">'rest of UK'</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>perhourworked <span class="ot">&lt;-</span> perhourworked <span class="sc">%&gt;%</span> </span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ns_england_restofUK_londonseparate =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">%in%</span> north <span class="sc">~</span> <span class="st">'North England'</span>,</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">%in%</span> south.minus.london <span class="sc">~</span> <span class="st">'South Eng (exc. London)'</span>,</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">'london'</span>,region,<span class="at">ignore.case =</span> T) <span class="sc">~</span> <span class="st">'London'</span>,</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">'rest of UK'</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co">#And a category for 'UK minus London'</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>perhourworked <span class="ot">&lt;-</span> perhourworked <span class="sc">%&gt;%</span> </span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">UK_minus_london =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">'london'</span>,region,<span class="at">ignore.case =</span> T) <span class="sc">~</span> <span class="st">'London'</span>,</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">'UK minus London'</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If wanted, we can check those geographical zone selections are correct by plotting the maps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check is all correct with map</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>itl2.geo <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">'data/ITL_geographies/International_Territorial_Level_2_January_2021_UK_BFE_V2_2022_-4735199360818908762/ITL2_JAN_2021_UK_BFE_V2.shp'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_simplify</span>(<span class="at">preserveTopology =</span> T, <span class="at">dTolerance =</span> <span class="dv">100</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Tick</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(england <span class="sc">%in%</span> itl2.geo<span class="sc">$</span>ITL221NM)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Ticks all round</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(itl2.geo <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ITL221NM <span class="sc">%in%</span> england)), <span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(itl2.geo <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ITL221NM <span class="sc">%in%</span> north)), <span class="at">col =</span> <span class="st">'blue'</span>, <span class="at">add =</span> T)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(itl2.geo <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ITL221NM <span class="sc">%in%</span> south)), <span class="at">col =</span> <span class="st">'green'</span>, <span class="at">add =</span> T)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(itl2.geo <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>ITL221NM <span class="sc">%in%</span> england.minus.london)), <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">add =</span> T)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(itl2.geo <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ITL221NM <span class="sc">%in%</span> uk.minus.london)), <span class="at">col =</span> <span class="st">'grey'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lastly - add a marker for a place of interest (South Yorkshire in this case) and plot interactively (hover for other region names). Here, we plot the average of the first three years rankings available in the data, then the first three years after 2010, then the last three years before COVID-19.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Add marker for South Yorkshire</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>perhourworked <span class="ot">&lt;-</span> perhourworked <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">selectedregion =</span> region <span class="sc">==</span> <span class="st">'South Yorkshire'</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot: first coalition years to pre covid</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(perhourworked <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2006</span>,<span class="dv">2012</span>,<span class="dv">2018</span>)), <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year), <span class="at">y =</span> rank_movingav, <span class="at">group =</span> region, <span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region), <span class="at">color =</span> <span class="st">"grey44"</span>) <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> selectedregion, <span class="at">size =</span> selectedregion)) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(ns_england_restofUK_londonseparate), <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'rank (3 year average)'</span>) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'year (average centre)'</span>) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="st">"none"</span>, <span class="at">shape =</span> <span class="st">"none"</span>, <span class="at">size =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">'region'</span>,<span class="st">'rank_movingav'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-612c51fe2fb2138f1711" style="width:100%;height:520px;"></div>
<script type="application/json" data-for="htmlwidget-612c51fe2fb2138f1711">{"x":{"data":[{"x":[1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3],"y":[40,40,40,null,41,41,41,null,37.666666666666664,37,35.833333333333336,null,36.666666666666664,37,36,null,38.666666666666664,38.666666666666664,39],"text":["rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav: 40.000000<br />region: Inner London - East",null,"rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 41.000000<br />region: Inner London - West",null,"rank_movingav: 37.666667<br />region: Outer London - East and North East","rank_movingav: 37.000000<br />region: Outer London - East and North East","rank_movingav: 35.833333<br />region: Outer London - East and North East",null,"rank_movingav: 36.666667<br />region: Outer London - South","rank_movingav: 37.000000<br />region: Outer London - South","rank_movingav: 36.000000<br />region: Outer London - South",null,"rank_movingav: 38.666667<br />region: Outer London - West and North West","rank_movingav: 38.666667<br />region: Outer London - West and North West","rank_movingav: 39.000000<br />region: Outer London - West and North West"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3],"y":[35,33.166666666666664,32,null,16.5,9,6.166666666666667,null,22.833333333333332,9.6666666666666661,11.833333333333334,null,20,23.333333333333332,20.5,null,15.666666666666666,7.5,16.166666666666668,null,23.666666666666668,24.166666666666668,15,null,26.833333333333332,15.166666666666666,17.333333333333332,null,11.833333333333334,15.5,15.166666666666666,null,5.166666666666667,6.833333333333333,3,null,19.833333333333332,19.5,12,null,19.166666666666668,14.166666666666666,14],"text":["rank_movingav: 35.000000<br />region: Cheshire","rank_movingav: 33.166667<br />region: Cheshire","rank_movingav: 32.000000<br />region: Cheshire",null,"rank_movingav: 16.500000<br />region: Cumbria","rank_movingav:  9.000000<br />region: Cumbria","rank_movingav:  6.166667<br />region: Cumbria",null,"rank_movingav: 22.833333<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav:  9.666667<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav: 11.833333<br />region: East Yorkshire and Northern Lincolnshire",null,"rank_movingav: 20.000000<br />region: Greater Manchester","rank_movingav: 23.333333<br />region: Greater Manchester","rank_movingav: 20.500000<br />region: Greater Manchester",null,"rank_movingav: 15.666667<br />region: Lancashire","rank_movingav:  7.500000<br />region: Lancashire","rank_movingav: 16.166667<br />region: Lancashire",null,"rank_movingav: 23.666667<br />region: Merseyside","rank_movingav: 24.166667<br />region: Merseyside","rank_movingav: 15.000000<br />region: Merseyside",null,"rank_movingav: 26.833333<br />region: North Yorkshire","rank_movingav: 15.166667<br />region: North Yorkshire","rank_movingav: 17.333333<br />region: North Yorkshire",null,"rank_movingav: 11.833333<br />region: Northumberland, and Tyne and Wear","rank_movingav: 15.500000<br />region: Northumberland, and Tyne and Wear","rank_movingav: 15.166667<br />region: Northumberland, and Tyne and Wear",null,"rank_movingav:  5.166667<br />region: South Yorkshire","rank_movingav:  6.833333<br />region: South Yorkshire","rank_movingav:  3.000000<br />region: South Yorkshire",null,"rank_movingav: 19.833333<br />region: Tees Valley and Durham","rank_movingav: 19.500000<br />region: Tees Valley and Durham","rank_movingav: 12.000000<br />region: Tees Valley and Durham",null,"rank_movingav: 19.166667<br />region: West Yorkshire","rank_movingav: 14.166667<br />region: West Yorkshire","rank_movingav: 14.000000<br />region: West Yorkshire"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3],"y":[12.166666666666666,18.833333333333332,15.666666666666666,null,29.666666666666668,30.666666666666668,33.666666666666664,null,12.666666666666666,25.833333333333332,24.333333333333332,null,29.666666666666668,35,29.333333333333332,null,4,4.666666666666667,5.5,null,15.666666666666666,20.333333333333332,20,null,12.5,23.5,24.166666666666668,null,1.8333333333333333,2.3333333333333335,4.5],"text":["rank_movingav: 12.166667<br />region: East Wales","rank_movingav: 18.833333<br />region: East Wales","rank_movingav: 15.666667<br />region: East Wales",null,"rank_movingav: 29.666667<br />region: Eastern Scotland","rank_movingav: 30.666667<br />region: Eastern Scotland","rank_movingav: 33.666667<br />region: Eastern Scotland",null,"rank_movingav: 12.666667<br />region: Highlands and Islands","rank_movingav: 25.833333<br />region: Highlands and Islands","rank_movingav: 24.333333<br />region: Highlands and Islands",null,"rank_movingav: 29.666667<br />region: North Eastern Scotland","rank_movingav: 35.000000<br />region: North Eastern Scotland","rank_movingav: 29.333333<br />region: North Eastern Scotland",null,"rank_movingav:  4.000000<br />region: Northern Ireland","rank_movingav:  4.666667<br />region: Northern Ireland","rank_movingav:  5.500000<br />region: Northern Ireland",null,"rank_movingav: 15.666667<br />region: Southern Scotland","rank_movingav: 20.333333<br />region: Southern Scotland","rank_movingav: 20.000000<br />region: Southern Scotland",null,"rank_movingav: 12.500000<br />region: West Central Scotland","rank_movingav: 23.500000<br />region: West Central Scotland","rank_movingav: 24.166667<br />region: West Central Scotland",null,"rank_movingav:  1.833333<br />region: West Wales and The Valleys","rank_movingav:  2.333333<br />region: West Wales and The Valleys","rank_movingav:  4.500000<br />region: West Wales and The Valleys"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3,null,1,2,3],"y":[33.166666666666664,28.833333333333332,28.666666666666668,null,37,37.333333333333336,37.833333333333336,null,2,1,1,null,13.166666666666666,16.5,13.166666666666666,null,7.833333333333333,7.833333333333333,9,null,14.666666666666666,7.666666666666667,10,null,23.333333333333332,24.833333333333332,23.666666666666668,null,28,21.333333333333332,27.833333333333332,null,29.833333333333332,30.333333333333332,31,null,31.666666666666668,33.5,36,null,17.166666666666668,19.666666666666668,23.333333333333332,null,27.333333333333332,26.833333333333332,28,null,11.166666666666666,12.833333333333334,14.666666666666666,null,3.5,4.666666666666667,5.833333333333333,null,9.3333333333333339,6.5,3.5,null,33.833333333333336,32.333333333333336,33.666666666666664,null,9.3333333333333339,16.166666666666668,21.666666666666668],"text":["rank_movingav: 33.166667<br />region: Bedfordshire and Hertfordshire","rank_movingav: 28.833333<br />region: Bedfordshire and Hertfordshire","rank_movingav: 28.666667<br />region: Bedfordshire and Hertfordshire",null,"rank_movingav: 37.000000<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 37.333333<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 37.833333<br />region: Berkshire, Buckinghamshire and Oxfordshire",null,"rank_movingav:  2.000000<br />region: Cornwall and Isles of Scilly","rank_movingav:  1.000000<br />region: Cornwall and Isles of Scilly","rank_movingav:  1.000000<br />region: Cornwall and Isles of Scilly",null,"rank_movingav: 13.166667<br />region: Derbyshire and Nottinghamshire","rank_movingav: 16.500000<br />region: Derbyshire and Nottinghamshire","rank_movingav: 13.166667<br />region: Derbyshire and Nottinghamshire",null,"rank_movingav:  7.833333<br />region: Devon","rank_movingav:  7.833333<br />region: Devon","rank_movingav:  9.000000<br />region: Devon",null,"rank_movingav: 14.666667<br />region: Dorset and Somerset","rank_movingav:  7.666667<br />region: Dorset and Somerset","rank_movingav: 10.000000<br />region: Dorset and Somerset",null,"rank_movingav: 23.333333<br />region: East Anglia","rank_movingav: 24.833333<br />region: East Anglia","rank_movingav: 23.666667<br />region: East Anglia",null,"rank_movingav: 28.000000<br />region: Essex","rank_movingav: 21.333333<br />region: Essex","rank_movingav: 27.833333<br />region: Essex",null,"rank_movingav: 29.833333<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav: 30.333333<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav: 31.000000<br />region: Gloucestershire, Wiltshire and Bath/Bristol area",null,"rank_movingav: 31.666667<br />region: Hampshire and Isle of Wight","rank_movingav: 33.500000<br />region: Hampshire and Isle of Wight","rank_movingav: 36.000000<br />region: Hampshire and Isle of Wight",null,"rank_movingav: 17.166667<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav: 19.666667<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav: 23.333333<br />region: Herefordshire, Worcestershire and Warwickshire",null,"rank_movingav: 27.333333<br />region: Kent","rank_movingav: 26.833333<br />region: Kent","rank_movingav: 28.000000<br />region: Kent",null,"rank_movingav: 11.166667<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav: 12.833333<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav: 14.666667<br />region: Leicestershire, Rutland and Northamptonshire",null,"rank_movingav:  3.500000<br />region: Lincolnshire","rank_movingav:  4.666667<br />region: Lincolnshire","rank_movingav:  5.833333<br />region: Lincolnshire",null,"rank_movingav:  9.333333<br />region: Shropshire and Staffordshire","rank_movingav:  6.500000<br />region: Shropshire and Staffordshire","rank_movingav:  3.500000<br />region: Shropshire and Staffordshire",null,"rank_movingav: 33.833333<br />region: Surrey, East and West Sussex","rank_movingav: 32.333333<br />region: Surrey, East and West Sussex","rank_movingav: 33.666667<br />region: Surrey, East and West Sussex",null,"rank_movingav:  9.333333<br />region: West Midlands","rank_movingav: 16.166667<br />region: West Midlands","rank_movingav: 21.666667<br />region: West Midlands"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2],"y":[41,40,37,37,38.666666666666664],"text":["rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav: 37.000000<br />region: Outer London - East and North East","rank_movingav: 37.000000<br />region: Outer London - South","rank_movingav: 38.666667<br />region: Outer London - West and North West"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,186,56,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2,2,2,2,2,2],"y":[19.5,15.5,9,23.333333333333332,7.5,33.166666666666664,24.166666666666668,9.6666666666666661,15.166666666666666,14.166666666666666],"text":["rank_movingav: 19.500000<br />region: Tees Valley and Durham","rank_movingav: 15.500000<br />region: Northumberland, and Tyne and Wear","rank_movingav:  9.000000<br />region: Cumbria","rank_movingav: 23.333333<br />region: Greater Manchester","rank_movingav:  7.500000<br />region: Lancashire","rank_movingav: 33.166667<br />region: Cheshire","rank_movingav: 24.166667<br />region: Merseyside","rank_movingav:  9.666667<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav: 15.166667<br />region: North Yorkshire","rank_movingav: 14.166667<br />region: West Yorkshire"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,186,56,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2,2,2,2],"y":[2.3333333333333335,18.833333333333332,35,25.833333333333332,30.666666666666668,23.5,20.333333333333332,4.666666666666667],"text":["rank_movingav:  2.333333<br />region: West Wales and The Valleys","rank_movingav: 18.833333<br />region: East Wales","rank_movingav: 35.000000<br />region: North Eastern Scotland","rank_movingav: 25.833333<br />region: Highlands and Islands","rank_movingav: 30.666667<br />region: Eastern Scotland","rank_movingav: 23.500000<br />region: West Central Scotland","rank_movingav: 20.333333<br />region: Southern Scotland","rank_movingav:  4.666667<br />region: Northern Ireland"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,186,56,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"y":[16.5,12.833333333333334,4.666666666666667,19.666666666666668,6.5,16.166666666666668,24.833333333333332,28.833333333333332,21.333333333333332,37.333333333333336,32.333333333333336,33.5,26.833333333333332,30.333333333333332,7.666666666666667,1,7.833333333333333],"text":["rank_movingav: 16.500000<br />region: Derbyshire and Nottinghamshire","rank_movingav: 12.833333<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav:  4.666667<br />region: Lincolnshire","rank_movingav: 19.666667<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav:  6.500000<br />region: Shropshire and Staffordshire","rank_movingav: 16.166667<br />region: West Midlands","rank_movingav: 24.833333<br />region: East Anglia","rank_movingav: 28.833333<br />region: Bedfordshire and Hertfordshire","rank_movingav: 21.333333<br />region: Essex","rank_movingav: 37.333333<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 32.333333<br />region: Surrey, East and West Sussex","rank_movingav: 33.500000<br />region: Hampshire and Isle of Wight","rank_movingav: 26.833333<br />region: Kent","rank_movingav: 30.333333<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav:  7.666667<br />region: Dorset and Somerset","rank_movingav:  1.000000<br />region: Cornwall and Isles of Scilly","rank_movingav:  7.833333<br />region: Devon"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,186,56,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2],"y":[6.833333333333333],"text":"rank_movingav:  6.833333<br />region: South Yorkshire","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","opacity":1,"size":22.677165354330711,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(0,186,56,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3,3,3,3,3],"y":[41,40,35.833333333333336,36,39],"text":["rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav: 35.833333<br />region: Outer London - East and North East","rank_movingav: 36.000000<br />region: Outer London - South","rank_movingav: 39.000000<br />region: Outer London - West and North West"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(97,156,255,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3,3,3,3,3,3,3,3,3,3],"y":[12,15.166666666666666,6.166666666666667,20.5,16.166666666666668,32,15,11.833333333333334,17.333333333333332,14],"text":["rank_movingav: 12.000000<br />region: Tees Valley and Durham","rank_movingav: 15.166667<br />region: Northumberland, and Tyne and Wear","rank_movingav:  6.166667<br />region: Cumbria","rank_movingav: 20.500000<br />region: Greater Manchester","rank_movingav: 16.166667<br />region: Lancashire","rank_movingav: 32.000000<br />region: Cheshire","rank_movingav: 15.000000<br />region: Merseyside","rank_movingav: 11.833333<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav: 17.333333<br />region: North Yorkshire","rank_movingav: 14.000000<br />region: West Yorkshire"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(97,156,255,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3,3,3,3,3,3,3,3],"y":[4.5,15.666666666666666,29.333333333333332,24.333333333333332,33.666666666666664,24.166666666666668,20,5.5],"text":["rank_movingav:  4.500000<br />region: West Wales and The Valleys","rank_movingav: 15.666667<br />region: East Wales","rank_movingav: 29.333333<br />region: North Eastern Scotland","rank_movingav: 24.333333<br />region: Highlands and Islands","rank_movingav: 33.666667<br />region: Eastern Scotland","rank_movingav: 24.166667<br />region: West Central Scotland","rank_movingav: 20.000000<br />region: Southern Scotland","rank_movingav:  5.500000<br />region: Northern Ireland"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(97,156,255,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],"y":[13.166666666666666,14.666666666666666,5.833333333333333,23.333333333333332,3.5,21.666666666666668,23.666666666666668,28.666666666666668,27.833333333333332,37.833333333333336,33.666666666666664,36,28,31,10,1,9],"text":["rank_movingav: 13.166667<br />region: Derbyshire and Nottinghamshire","rank_movingav: 14.666667<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav:  5.833333<br />region: Lincolnshire","rank_movingav: 23.333333<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav:  3.500000<br />region: Shropshire and Staffordshire","rank_movingav: 21.666667<br />region: West Midlands","rank_movingav: 23.666667<br />region: East Anglia","rank_movingav: 28.666667<br />region: Bedfordshire and Hertfordshire","rank_movingav: 27.833333<br />region: Essex","rank_movingav: 37.833333<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 33.666667<br />region: Surrey, East and West Sussex","rank_movingav: 36.000000<br />region: Hampshire and Isle of Wight","rank_movingav: 28.000000<br />region: Kent","rank_movingav: 31.000000<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav: 10.000000<br />region: Dorset and Somerset","rank_movingav:  1.000000<br />region: Cornwall and Isles of Scilly","rank_movingav:  9.000000<br />region: Devon"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(97,156,255,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3],"y":[3],"text":"rank_movingav:  3.000000<br />region: South Yorkshire","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","opacity":1,"size":22.677165354330711,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(97,156,255,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1],"y":[41,40,37.666666666666664,36.666666666666664,38.666666666666664],"text":["rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav: 37.666667<br />region: Outer London - East and North East","rank_movingav: 36.666667<br />region: Outer London - South","rank_movingav: 38.666667<br />region: Outer London - West and North West"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1,1,1,1,1,1],"y":[19.833333333333332,11.833333333333334,16.5,20,15.666666666666666,35,23.666666666666668,22.833333333333332,26.833333333333332,19.166666666666668],"text":["rank_movingav: 19.833333<br />region: Tees Valley and Durham","rank_movingav: 11.833333<br />region: Northumberland, and Tyne and Wear","rank_movingav: 16.500000<br />region: Cumbria","rank_movingav: 20.000000<br />region: Greater Manchester","rank_movingav: 15.666667<br />region: Lancashire","rank_movingav: 35.000000<br />region: Cheshire","rank_movingav: 23.666667<br />region: Merseyside","rank_movingav: 22.833333<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav: 26.833333<br />region: North Yorkshire","rank_movingav: 19.166667<br />region: West Yorkshire"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1,1,1,1],"y":[1.8333333333333333,12.166666666666666,29.666666666666668,12.666666666666666,29.666666666666668,12.5,15.666666666666666,4],"text":["rank_movingav:  1.833333<br />region: West Wales and The Valleys","rank_movingav: 12.166667<br />region: East Wales","rank_movingav: 29.666667<br />region: North Eastern Scotland","rank_movingav: 12.666667<br />region: Highlands and Islands","rank_movingav: 29.666667<br />region: Eastern Scotland","rank_movingav: 12.500000<br />region: West Central Scotland","rank_movingav: 15.666667<br />region: Southern Scotland","rank_movingav:  4.000000<br />region: Northern Ireland"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"y":[13.166666666666666,11.166666666666666,3.5,17.166666666666668,9.3333333333333339,9.3333333333333339,23.333333333333332,33.166666666666664,28,37,33.833333333333336,31.666666666666668,27.333333333333332,29.833333333333332,14.666666666666666,2,7.833333333333333],"text":["rank_movingav: 13.166667<br />region: Derbyshire and Nottinghamshire","rank_movingav: 11.166667<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav:  3.500000<br />region: Lincolnshire","rank_movingav: 17.166667<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav:  9.333333<br />region: Shropshire and Staffordshire","rank_movingav:  9.333333<br />region: West Midlands","rank_movingav: 23.333333<br />region: East Anglia","rank_movingav: 33.166667<br />region: Bedfordshire and Hertfordshire","rank_movingav: 28.000000<br />region: Essex","rank_movingav: 37.000000<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 33.833333<br />region: Surrey, East and West Sussex","rank_movingav: 31.666667<br />region: Hampshire and Isle of Wight","rank_movingav: 27.333333<br />region: Kent","rank_movingav: 29.833333<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav: 14.666667<br />region: Dorset and Somerset","rank_movingav:  2.000000<br />region: Cornwall and Isles of Scilly","rank_movingav:  7.833333<br />region: Devon"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1],"y":[5.166666666666667],"text":"rank_movingav:  5.166667<br />region: South Yorkshire","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":22.677165354330711,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":36.821917808219183,"r":7.3059360730593621,"b":39.086757990867596,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,0.24714611872146119],"automargin":true,"type":"linear","autorange":false,"range":[0.40000000000000002,3.6000000000000001],"tickmode":"array","ticktext":["2006","2012","2018"],"tickvals":[1,2,3],"categoryorder":"array","categoryarray":["2006","2012","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716894984},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"year (average centre)","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.917808219178088},{"text":"rank (3 year average)","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-21.917808219178088},{"text":"London","x":0.1235730593607306,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716894984},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"North England","x":0.375,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716894984},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"rest of UK","x":0.625,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716894984},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"South Eng (exc. London)","x":0.8764269406392694,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.689497716894984},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1,43],"tickmode":"array","ticktext":["0","10","20","30","40"],"tickvals":[0,10,20,30,40],"categoryorder":"array","categoryarray":["0","10","20","30","40"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.24714611872146119,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.24714611872146119,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.25285388127853881,"x1":0.49714611872146119,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.25285388127853881,"x1":0.49714611872146119,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.50285388127853881,"x1":0.74714611872146119,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.50285388127853881,"x1":0.74714611872146119,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.75285388127853881,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.75285388127853881,"x1":1,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.40000000000000002,3.6000000000000001],"tickmode":"array","ticktext":["2006","2012","2018"],"tickvals":[1,2,3],"categoryorder":"array","categoryarray":["2006","2012","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716894984},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.25285388127853881,0.49714611872146119],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"xaxis3":{"type":"linear","autorange":false,"range":[0.40000000000000002,3.6000000000000001],"tickmode":"array","ticktext":["2006","2012","2018"],"tickvals":[1,2,3],"categoryorder":"array","categoryarray":["2006","2012","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716894984},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.50285388127853881,0.74714611872146119],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"xaxis4":{"type":"linear","autorange":false,"range":[0.40000000000000002,3.6000000000000001],"tickmode":"array","ticktext":["2006","2012","2018"],"tickvals":[1,2,3],"categoryorder":"array","categoryarray":["2006","2012","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716894984},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.75285388127853881,1],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716894984},"title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"15e6b170b9269":{"x":{},"y":{},"colour":{},"type":"scatter"},"15e6b2a12a7a8":{"x":{},"y":{},"colour":{},"shape":{},"size":{}}},"cur_data":"15e6b170b9269","visdat":{"15e6b170b9269":["function (y) ","x"],"15e6b2a12a7a8":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="finding-weighted-averages-for-per-hour-productivity" class="level2">
<h2 class="anchored" data-anchor-id="finding-weighted-averages-for-per-hour-productivity">Finding weighted averages for per hour productivity</h2>
<p>We want to compare specific places to the rest of the UK - and also, possibly, the rest of the UK minus London, because London is such an outlier. To do this, we’ll need average per-hour-productivity values for the UK as as a whole, as well as regional subsets.</p>
<p>But each place differs in size - the per-hour-productivity values for each need adjusting to account for that. Here, we’ll <strong>weight the averages by the total number of hours worked in each ITL2 zone</strong>. This data is available in another sheet from the regional GDP ONS data (stored here in the data folder as itlproductivity.xlsx).</p>
<p>Values for one <em>before</em> the latest year in the data is used (2020) to match the centre point of the three year moving average.</p>
<p>First, get the ‘total hours a week’ data and add in the regional labels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#WEIGHTED AVERAGES</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Using number of hours worked per ITL2</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Get hours worked per week total for ITL2</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>totalhoursperweek <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/Productivity Hours Worked per Week ITL2 and ITL3 subregions constrained to ITL1 2004 2021.csv'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ITL =</span> <span class="st">`</span><span class="at">ITL level</span><span class="st">`</span>, <span class="at">ITLcode =</span> <span class="st">`</span><span class="at">ITL code</span><span class="st">`</span>, <span class="at">region =</span> <span class="st">`</span><span class="at">Region name</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITL <span class="sc">==</span> <span class="st">'ITL2'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">2004</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2021</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">'year'</span>, <span class="at">values_to =</span> <span class="st">'hours_per_week'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#And same for ITL3 regions</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>totalhoursperweek.itl3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/Productivity Hours Worked per Week ITL2 and ITL3 subregions constrained to ITL1 2004 2021.csv'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ITL =</span> <span class="st">`</span><span class="at">ITL level</span><span class="st">`</span>, <span class="at">ITLcode =</span> <span class="st">`</span><span class="at">ITL code</span><span class="st">`</span>, <span class="at">region =</span> <span class="st">`</span><span class="at">Region name</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITL <span class="sc">==</span> <span class="st">'ITL3'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">2004</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2021</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">'year'</span>, <span class="at">values_to =</span> <span class="st">'hours_per_week'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># #Add in all the region labels</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># totalhoursperweek.itl2 &lt;- totalhoursperweek.itl2 %&gt;% </span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(ns_england_restofUK = case_when(</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     region %in% north ~ 'North England',</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     region %in% south ~ 'South Eng (inc. London)',</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     .default = 'rest of UK'</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   ))</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co"># totalhoursperweek.itl2 &lt;- totalhoursperweek.itl2 %&gt;% </span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(ns_england_restofUK_londonseparate = case_when(</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     region %in% north ~ 'North England',</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     region %in% south.minus.london ~ 'South Eng (exc. London)',</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     grepl('london',region,ignore.case = T) ~ 'London',</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     .default = 'rest of UK'</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   ))</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co"># totalhoursperweek.itl2 &lt;- totalhoursperweek.itl2 %&gt;% </span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(UK_minus_london = case_when(</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co">#     grepl('london',region,ignore.case = T) ~ 'London',</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co">#     .default = 'UK minus London'</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   ))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, join to the GVA per hour data, for 2020, and then get weighted averages for specific regions (including the whole of the UK minus London):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>perhourworked.withtotalhours <span class="ot">&lt;-</span> perhourworked <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    totalhoursperweek <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(region,hours_per_week),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">'region'</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#UK weighted average INCLUDING London</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>weightedaverages.perhourworked.UK <span class="ot">&lt;-</span> perhourworked.withtotalhours <span class="sc">%&gt;%</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sy =</span> perhourworked <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>, region <span class="sc">==</span> <span class="st">'South Yorkshire'</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(movingav) <span class="sc">%&gt;%</span> pull,<span class="co">#put SY in there to directly compare</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_gva_av3years_weighted =</span> <span class="fu">weighted.mean</span>(movingav, hours_per_week, <span class="at">na.rm=</span>T)<span class="co">#get weighted average by each ITL2 grouping</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff =</span> (mean_gva_av3years_weighted <span class="sc">-</span> sy)<span class="sc">/</span>sy</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="do">##UK weighted average EXCLUDING London (and comparing JUST to London)</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>weightedaverages.perhourworked.UKminuslondon <span class="ot">&lt;-</span> perhourworked.withtotalhours <span class="sc">%&gt;%</span> </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UK_minus_london) <span class="sc">%&gt;%</span> <span class="co">#group by "UK minus london" vs "london by itself"</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">sy =</span> perhourworked <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>, region <span class="sc">==</span> <span class="st">'South Yorkshire'</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(movingav) <span class="sc">%&gt;%</span> pull,<span class="co">#put SY in there to directly compare</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_gva_av3years_weighted =</span> <span class="fu">weighted.mean</span>(movingav, hours_per_week, <span class="at">na.rm=</span>T)<span class="co">#get weighted average by each ITL2 grouping</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff =</span> (mean_gva_av3years_weighted <span class="sc">-</span> sy)<span class="sc">/</span>sy</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">#So SY would need to be ~17.7% more productive to match non London UK average</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#Weighted averages, comparison to rest of North</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>weightedaverages.perhourworked.north <span class="ot">&lt;-</span> perhourworked.withtotalhours <span class="sc">%&gt;%</span> </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ns_england_restofUK_londonseparate) <span class="sc">%&gt;%</span> <span class="co">#group by "UK minus london" vs "london by itself"</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">sy =</span> perhourworked <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>, region <span class="sc">==</span> <span class="st">'South Yorkshire'</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(movingav) <span class="sc">%&gt;%</span> pull,</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_gva_av3years_weighted =</span> <span class="fu">weighted.mean</span>(movingav, hours_per_week, <span class="at">na.rm=</span>T)<span class="co">#get weighted average by each ITL2 grouping</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff =</span> (mean_gva_av3years_weighted <span class="sc">-</span> sy)<span class="sc">/</span>sy</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co">#Sanity check the weighted average manually, check with london</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co">#TICK</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>chk <span class="ot">&lt;-</span> perhourworked <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    totalhoursperweek <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(region,hours_per_week),</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">'region'</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">'london'</span>,region,<span class="at">ignore.case =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hours_per_week_normalised =</span> hours_per_week <span class="sc">/</span> <span class="fu">sum</span>(hours_per_week)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">manualweightedav_weights =</span> movingav <span class="sc">*</span> hours_per_week_normalised,</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">manualweightedav =</span> <span class="fu">sum</span>(manualweightedav_weights)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="repeat-for-sheffield-vs-bdr" class="level2">
<h2 class="anchored" data-anchor-id="repeat-for-sheffield-vs-bdr">Repeat for Sheffield vs BDR</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Test if ITL3 codes nest handily into ITL2 and so can act as lookup for the regions I've already labelled above (rather than having to intersect)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Tick! Probably. Need to check...</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">str_sub</span>(perhourworked.itl3<span class="sc">$</span>ITLcode,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">2</span>) <span class="sc">%in%</span> perhourworked<span class="sc">$</span>ITLcode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
TRUE 
3222 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Add the probably-ITL2 code lookup to ITL3 data</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>perhourworked.itl3 <span class="ot">&lt;-</span> perhourworked.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ITL2code =</span> <span class="fu">str_sub</span>(perhourworked.itl3<span class="sc">$</span>ITLcode,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">2</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Merge in region labels from the ITL2 data</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>perhourworked.itl3 <span class="ot">&lt;-</span> perhourworked.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    perhourworked <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ITLcode, ns_england_restofUK, ns_england_restofUK_londonseparate) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">ITL2code =</span> ITLcode, ns_england_restofUK, ns_england_restofUK_londonseparate),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">'ITL2code'</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#No newcastle, where's that gone? Oh it's Tyne</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_mode('view')</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># tm_shape(perhourworked.itl3.geo) +</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_polygons(id = 'region') +</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_layout(title = '', legend.outside = T)</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Add in an extra one for the shortlist of 11 'core cities'</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Belfast, Birmingham, Bristol, Cardiff, Glasgow, Leeds, Liverpool, Manchester, Newcastle, Nottingham, Sheffield</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">#https://www.corecities.com/about-us/what-core-cities-uk</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Check how many we match... Tyneside for Newcastle, then all good</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>corecities <span class="ot">&lt;-</span> perhourworked.itl3<span class="sc">$</span>region[<span class="fu">grepl</span>(<span class="at">x =</span> perhourworked.itl3<span class="sc">$</span>region, <span class="at">pattern =</span> <span class="st">'sheffield|Belfast|Birmingham|Bristol|Cardiff|Glasgow|Leeds|Liverpool|Manchester|Tyne|Nottingham'</span>, <span class="at">ignore.case =</span> T)] <span class="sc">%&gt;%</span> unique</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">#Yes, all in there, need to remove a few...</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>corecities <span class="ot">&lt;-</span> corecities[<span class="sc">!</span><span class="fu">grepl</span>(<span class="at">x =</span> corecities, <span class="at">pattern =</span> <span class="st">'Greater|shire'</span>, <span class="at">ignore.case =</span> T)]</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>corecities <span class="ot">&lt;-</span> corecities[<span class="fu">order</span>(corecities)]</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>perhourworked.itl3 <span class="ot">&lt;-</span> perhourworked.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">core_cities =</span> <span class="fu">ifelse</span>(region <span class="sc">%in%</span> corecities, <span class="st">'Core city'</span>, <span class="st">'Other'</span>),</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">core_cities_minus_sheffield =</span> <span class="fu">ifelse</span>(region <span class="sc">%in%</span> corecities[corecities<span class="sc">!=</span><span class="st">'Sheffield'</span>],<span class="st">'Core city (exc. Sheffield)'</span>,<span class="st">'Other'</span>)<span class="co">#without sheffield, so not including in weighted average</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co">#Check map</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co"># itl3.geo &lt;- st_read('data/ITL_geographies/International_Territorial_Level_3_January_2021_UK_BUC_V3_2022_6920195468392554877/ITL3_JAN_2021_UK_BUC_V3.shp') %&gt;%</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   st_simplify(preserveTopology = T, dTolerance = 100)</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co"># #Ticks all round</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(st_geometry(itl3.geo), col = 'grey')</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(st_geometry(itl3.geo %&gt;% filter(ITL321CD %in% perhourworked.itl3$ITLcode[perhourworked.itl3$ns_england_restofUK_londonseparate=='North England'])), col = 'red', add  = T)</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(st_geometry(itl3.geo %&gt;% filter(ITL321CD %in% perhourworked.itl3$ITLcode[perhourworked.itl3$ns_england_restofUK_londonseparate=='South Eng (exc. London)'])), col = 'blue', add = T)</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(st_geometry(itl3.geo %&gt;% filter(ITL321CD %in% perhourworked.itl3$ITLcode[perhourworked.itl3$ns_england_restofUK_londonseparate=='London'])), col = 'green', add = T)</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(st_geometry(itl3.geo %&gt;% filter(ITL321CD %in% perhourworked.itl3$ITLcode[perhourworked.itl3$ns_england_restofUK_londonseparate=='rest of UK'])), col = 'orange', add = T)</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Repeat rank plot</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>perhourworked.itl3 <span class="ot">&lt;-</span> perhourworked.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(gva))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#3 year smoothing</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>perhourworked.itl3 <span class="ot">&lt;-</span> perhourworked.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">movingav =</span> <span class="fu">rollapply</span>(gva,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'right'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank_movingav =</span> <span class="fu">rollapply</span>(rank,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'right'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank_movingav_7yr =</span> <span class="fu">rollapply</span>(rank,<span class="dv">7</span>,mean,<span class="at">align=</span><span class="st">'right'</span>,<span class="at">fill=</span><span class="cn">NA</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>perhourworked.itl3 <span class="ot">&lt;-</span> perhourworked.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">selectedregion =</span> <span class="fu">grepl</span>(<span class="at">x =</span> region, <span class="at">pattern =</span> <span class="st">'Shef|Doncaster'</span>,<span class="at">ignore.case =</span> T))</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">#How many years available with smoothed 3 year data?</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#2006 to 2021</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(perhourworked.itl3<span class="sc">$</span>year[<span class="sc">!</span><span class="fu">is.na</span>(perhourworked.itl3<span class="sc">$</span>movingav)])</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(perhourworked.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2006</span>,<span class="dv">2018</span>)), <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year), <span class="at">y =</span> rank_movingav, <span class="at">group =</span> region, <span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region), <span class="at">color =</span> <span class="st">"grey44"</span>) <span class="sc">+</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> selectedregion, <span class="at">size =</span> selectedregion)) <span class="sc">+</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(ns_england_restofUK_londonseparate), <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'rank (3 year average)'</span>) <span class="sc">+</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'year (average centre)'</span>) <span class="sc">+</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="st">"none"</span>, <span class="at">shape =</span> <span class="st">"none"</span>, <span class="at">size =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">'region'</span>,<span class="st">'rank_movingav'</span>))</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="co">#Split into dropped vs rose, plot separately</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="co">#Has to be for specific pair of years so let's pick those year</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>startyear <span class="ot">=</span> <span class="dv">2012</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>endyear <span class="ot">=</span> <span class="dv">2020</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>polarity <span class="ot">&lt;-</span> perhourworked.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(startyear, endyear)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region,year,rank_movingav) <span class="sc">%&gt;%</span> </span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> rank_movingav) <span class="sc">%&gt;%</span> </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">roseovertime =</span> <span class="sc">!!</span><span class="fu">as.name</span>(startyear) <span class="sc">&lt;</span> <span class="sc">!!</span><span class="fu">as.name</span>(endyear),</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">rankpositionchange =</span> <span class="sc">!!</span><span class="fu">as.name</span>(endyear) <span class="sc">-</span> <span class="sc">!!</span><span class="fu">as.name</span>(startyear)</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="co">#Drop if repeating</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>perhourworked.itl3 <span class="ot">&lt;-</span> perhourworked.itl3[,<span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>]</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a><span class="co">#Add that label back into perhourworked.itl3</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>perhourworked.itl3 <span class="ot">&lt;-</span> perhourworked.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(polarity <span class="sc">%&gt;%</span> <span class="fu">select</span>(region, roseovertime, rankpositionchange), <span class="at">by =</span> <span class="st">'region'</span>)</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(perhourworked.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2006</span>,<span class="dv">2012</span>,<span class="dv">2018</span>)), <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year), <span class="at">y =</span> rank_movingav, <span class="at">group =</span> region, <span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region), <span class="at">color =</span> <span class="st">"grey44"</span>) <span class="sc">+</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> selectedregion, <span class="at">size =</span> selectedregion)) <span class="sc">+</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(roseovertime,ns_england_restofUK_londonseparate), <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'rank (3 year average)'</span>) <span class="sc">+</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'year (average centre)'</span>) <span class="sc">+</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="st">"none"</span>, <span class="at">shape =</span> <span class="st">"none"</span>, <span class="at">size =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">'region'</span>,<span class="st">'rank_movingav'</span>))</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a><span class="co">#Any kind of geography to that?</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a><span class="co"># perhourworked.itl3.geo &lt;- itl3.geo %&gt;% </span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a><span class="co">#   right_join(perhourworked.itl3, by = c('ITL321CD' = 'ITLcode'))</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a><span class="co"># tm_shape(perhourworked.itl3.geo) +</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_polygons('rankpositionchange', n = 9, palette = 'BrBG') +</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   tm_layout(title = '', legend.outside = T)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gva-per-hour-worked-gap-over-time" class="level2">
<h2 class="anchored" data-anchor-id="gva-per-hour-worked-gap-over-time">GVA per hour worked: gap over time</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>perhourworked.withtotalhours <span class="ot">&lt;-</span> perhourworked <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(movingav,rank_movingav,rank_movingav_7yr)) <span class="sc">%&gt;%</span> <span class="co">#drop moving averages, redo after</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    totalhoursperweek <span class="sc">%&gt;%</span> <span class="fu">select</span>(region,hours_per_week,year),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'region'</span>,<span class="st">'year'</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Weighted averages</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>weightedaverages.perhourworked.UKminuslondon <span class="ot">&lt;-</span> perhourworked.withtotalhours <span class="sc">%&gt;%</span> </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region_grouping =</span> UK_minus_london) <span class="sc">%&gt;%</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_grouping,year) <span class="sc">%&gt;%</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">weighted_mean_gva =</span> <span class="fu">weighted.mean</span>(gva, hours_per_week, <span class="at">na.rm=</span>T)<span class="co">#get weighted average by each ITL2 grouping</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co">#merge in SY values</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(perhourworked <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">'South Yorkshire'</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">SouthYorks_gva =</span> gva), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff =</span> (weighted_mean_gva <span class="sc">-</span> SouthYorks_gva)<span class="sc">/</span>SouthYorks_gva,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_3yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weightedaverages.perhourworked.UKminuslondon, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop_diff_3yrsmooth <span class="sc">*</span> <span class="dv">100</span>, <span class="at">colour =</span> region_grouping)) <span class="sc">+</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">80</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="gdp_gaps_files/figure-html/gvagapovertime_itl2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#For other groupings...</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>weightedaverages.perhourworked.regions <span class="ot">&lt;-</span> perhourworked.withtotalhours <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region_grouping =</span> ns_england_restofUK_londonseparate) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_grouping,year) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">weighted_mean_gva =</span> <span class="fu">weighted.mean</span>(gva, hours_per_week, <span class="at">na.rm=</span>T)<span class="co">#get weighted average by each ITL2 grouping</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co">#merge in SY values</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(perhourworked <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">'South Yorkshire'</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">SouthYorks_gva =</span> gva), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff =</span> (weighted_mean_gva <span class="sc">-</span> SouthYorks_gva)<span class="sc">/</span>SouthYorks_gva,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_3yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weightedaverages.perhourworked.regions, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop_diff_3yrsmooth <span class="sc">*</span> <span class="dv">100</span>, <span class="at">colour =</span> region_grouping)) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">80</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="gdp_gaps_files/figure-html/gvagapovertime_itl2-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#COMPARE TO SELECTION OF ITL2 ZONES / OTHER MCAs</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#VERSION TO DIRECTLY COMPARE SY TO OTHER MCAS</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#List of ITL2</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(perhourworked.withtotalhours<span class="sc">$</span>region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Tees Valley and Durham"                          
 [2] "Northumberland, and Tyne and Wear"               
 [3] "Cumbria"                                         
 [4] "Greater Manchester"                              
 [5] "Lancashire"                                      
 [6] "Cheshire"                                        
 [7] "Merseyside"                                      
 [8] "East Yorkshire and Northern Lincolnshire"        
 [9] "North Yorkshire"                                 
[10] "South Yorkshire"                                 
[11] "West Yorkshire"                                  
[12] "Derbyshire and Nottinghamshire"                  
[13] "Leicestershire, Rutland and Northamptonshire"    
[14] "Lincolnshire"                                    
[15] "Herefordshire, Worcestershire and Warwickshire"  
[16] "Shropshire and Staffordshire"                    
[17] "West Midlands"                                   
[18] "East Anglia"                                     
[19] "Bedfordshire and Hertfordshire"                  
[20] "Essex"                                           
[21] "Inner London - West"                             
[22] "Inner London - East"                             
[23] "Outer London - East and North East"              
[24] "Outer London - South"                            
[25] "Outer London - West and North West"              
[26] "Berkshire, Buckinghamshire and Oxfordshire"      
[27] "Surrey, East and West Sussex"                    
[28] "Hampshire and Isle of Wight"                     
[29] "Kent"                                            
[30] "Gloucestershire, Wiltshire and Bath/Bristol area"
[31] "Dorset and Somerset"                             
[32] "Cornwall and Isles of Scilly"                    
[33] "Devon"                                           
[34] "West Wales and The Valleys"                      
[35] "East Wales"                                      
[36] "North Eastern Scotland"                          
[37] "Highlands and Islands"                           
[38] "Eastern Scotland"                                
[39] "West Central Scotland"                           
[40] "Southern Scotland"                               
[41] "Northern Ireland"                                </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Selection... don't think we have an easy ITL2 East Mids match, will have to come back to...</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>mcas <span class="ot">&lt;-</span> perhourworked.withtotalhours<span class="sc">$</span>region[<span class="fu">grepl</span>(<span class="st">'South Y|Manc|West Y|West M|Tyne|Tees|West of Eng|North Y|Liverpool|East M'</span>, perhourworked.withtotalhours<span class="sc">$</span>region, <span class="at">ignore.case =</span> T)] <span class="sc">%&gt;%</span> unique</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#MCA to get proportion gaps to others</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>comparator <span class="ot">=</span> perhourworked.withtotalhours<span class="sc">$</span>region[<span class="fu">grepl</span>(<span class="st">'South Y'</span>, perhourworked.withtotalhours<span class="sc">$</span>region, <span class="at">ignore.case =</span> T)] <span class="sc">%&gt;%</span> unique</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># comparator = perhourworked.withtotalhours$region[grepl('Greater M', perhourworked.withtotalhours$region, ignore.case = T)] %&gt;% unique</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>mcacompare <span class="ot">&lt;-</span> perhourworked.withtotalhours <span class="sc">%&gt;%</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, year, gva) <span class="sc">%&gt;%</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> mcas[mcas<span class="sc">!=</span>comparator]) <span class="sc">%&gt;%</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    perhourworked.withtotalhours <span class="sc">%&gt;%</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(region <span class="sc">==</span>comparator) <span class="sc">%&gt;%</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(year, <span class="at">comp_gva =</span> gva),</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">'year'</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_diff =</span> (gva <span class="sc">-</span> comp_gva)<span class="sc">/</span>comp_gva) <span class="sc">%&gt;%</span> </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_3yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_5yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">5</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mcacompare, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop_diff_3yrsmooth <span class="sc">*</span> <span class="dv">100</span>, <span class="at">colour =</span> <span class="fu">fct_reorder</span>(region, prop_diff_5yrsmooth))) <span class="sc">+</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(corecompare, aes(x = year, y = prop_diff * 100, colour = fct_reorder(region, prop_diff))) +</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_cartesian(ylim = c(-1,30)) +</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Paired'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="gdp_gaps_files/figure-html/gvagapovertime_itl2-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="repeat-for-itl3" class="level2">
<h2 class="anchored" data-anchor-id="repeat-for-itl3">Repeat for ITL3</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check region match... tick</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># table(perhourworked.itl3$region %in% totalhoursperweek.itl3$region)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Join </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>perhourworked.withtotalhours.itl3 <span class="ot">&lt;-</span> perhourworked.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select(-c(movingav,rank_movingav,rank_movingav_7yr)) %&gt;% #drop moving averages, redo after</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    totalhoursperweek.itl3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(region,hours_per_week,year),</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'region'</span>,<span class="st">'year'</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#For other groupings...</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>weightedaverages.perhourworked.itl3.regions <span class="ot">&lt;-</span> perhourworked.withtotalhours.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region_grouping =</span> ns_england_restofUK_londonseparate) <span class="sc">%&gt;%</span> </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_grouping,year) <span class="sc">%&gt;%</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">weighted_mean_gva =</span> <span class="fu">weighted.mean</span>(gva, hours_per_week, <span class="at">na.rm=</span>T)<span class="co">#get weighted average by each ITL2 grouping</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co">#merge in SY values</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(perhourworked.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">'Sheffield'</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">Sheffield_gva =</span> gva), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(perhourworked.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">x =</span> region, <span class="at">pattern =</span> <span class="st">'Barnsley'</span>, <span class="at">ignore.case =</span> T)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">BDR_gva =</span> gva), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>)) </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Repeat for core cities exc Sheffield</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>weightedaverages.perhourworked.itl3.cores <span class="ot">&lt;-</span> perhourworked.withtotalhours.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region_grouping =</span> core_cities_minus_sheffield) <span class="sc">%&gt;%</span> </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_grouping,year) <span class="sc">%&gt;%</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">weighted_mean_gva =</span> <span class="fu">weighted.mean</span>(gva, hours_per_week, <span class="at">na.rm=</span>T)<span class="co">#get weighted average by each ITL2 grouping</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co">#merge in SY values</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(perhourworked.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">'Sheffield'</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">Sheffield_gva =</span> gva), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(perhourworked.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">x =</span> region, <span class="at">pattern =</span> <span class="st">'Barnsley'</span>, <span class="at">ignore.case =</span> T)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">BDR_gva =</span> gva), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>)) </span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co">#Append those two</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>weightedavs.itl3 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>  weightedaverages.perhourworked.itl3.regions,</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  weightedaverages.perhourworked.itl3.cores <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region_grouping<span class="sc">!=</span><span class="st">'Other'</span>)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Make Sheffield and BDR gva long, and find proportion diffs</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>weightedavs.itl3 <span class="ot">&lt;-</span> weightedavs.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Sheffield_gva<span class="sc">:</span>BDR_gva, <span class="at">names_to =</span> <span class="st">'place'</span>, <span class="at">values_to =</span> <span class="st">'gva'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff =</span> (weighted_mean_gva <span class="sc">-</span> gva)<span class="sc">/</span>gva</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_grouping,place) <span class="sc">%&gt;%</span> </span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_3yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_5yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">5</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weightedavs.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region_grouping<span class="sc">!=</span><span class="st">'London'</span>), <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop_diff_3yrsmooth <span class="sc">*</span> <span class="dv">100</span>, <span class="at">colour =</span> region_grouping)) <span class="sc">+</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(weightedavs.itl3 %&gt;% filter(region_grouping!='London', !is.na(prop_diff_5yrsmooth)), aes(x = year, y = prop_diff_5yrsmooth * 100, colour = region_grouping)) +</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(weightedavs.itl3, aes(x = year, y = prop_diff * 100, colour = region_grouping)) +</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>place)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="gdp_gaps_files/figure-html/gvagapovertime_itl3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#VERSION TO DIRECTLY COMPARE SHEFFIELD TO OTHER 'CORE CITIES'</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Exclude Sheffield, as we want % diff for Sheffield, will add as own column</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Don't need hours per week as using direct GVA comparison, no need for weighted av</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>comparator <span class="ot">=</span> <span class="st">'Sheffield'</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # comparator = 'Manchester'</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># comparator = 'Leeds'</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>corecompare <span class="ot">&lt;-</span> perhourworked.withtotalhours.itl3 <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, year, gva) <span class="sc">%&gt;%</span> </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> corecities[corecities<span class="sc">!=</span>comparator]) <span class="sc">%&gt;%</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    perhourworked.withtotalhours.itl3 <span class="sc">%&gt;%</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(region <span class="sc">==</span>comparator) <span class="sc">%&gt;%</span> </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(year, <span class="at">sheffield_gva =</span> gva),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">'year'</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_diff =</span> (gva <span class="sc">-</span> sheffield_gva)<span class="sc">/</span>sheffield_gva) <span class="sc">%&gt;%</span> </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_3yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_5yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">5</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(corecompare, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop_diff_3yrsmooth <span class="sc">*</span> <span class="dv">100</span>, <span class="at">colour =</span> <span class="fu">fct_reorder</span>(region, prop_diff_5yrsmooth))) <span class="sc">+</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(corecompare, aes(x = year, y = prop_diff * 100, colour = fct_reorder(region, prop_diff))) +</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_cartesian(ylim = c(-1,30)) +</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Paired'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="gdp_gaps_files/figure-html/gvagapovertime_itl3-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="compare-places-using-gva-per-capita" class="level2">
<h2 class="anchored" data-anchor-id="compare-places-using-gva-per-capita">Compare places using GVA per capita</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get population numbers for per person figures</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#From regionalgrossvalueaddedbalancedbyindustryandallitlregions.xlsx</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ONS mid year population estimates</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Table 6 (not sure where they got consistent ITL2 geogs from...)</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>personcounts <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/Table 6 Total resident population numbers persons.csv'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ITLcode =</span> <span class="st">`</span><span class="at">ITL code</span><span class="st">`</span>, <span class="at">region =</span> <span class="st">`</span><span class="at">Region name</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITL <span class="sc">==</span> <span class="st">'ITL2'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">1998</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2021</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">'year'</span>, <span class="at">values_to =</span> <span class="st">'personcount'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Total GVA in current basic prices from the same source</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>gva.cp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/Table 1 GVA balanced at current basic prices millions.csv'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ITLcode =</span> <span class="st">`</span><span class="at">ITL code</span><span class="st">`</span>, <span class="at">region =</span> <span class="st">`</span><span class="at">Region name</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITL <span class="sc">==</span> <span class="st">'ITL2'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">1998</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2021</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">'year'</span>, <span class="at">values_to =</span> <span class="st">'gva'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Add person counts in to get GVA per capita</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Check link match... tick</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(personcounts<span class="sc">$</span>region <span class="sc">%in%</span> gva.cp<span class="sc">$</span>region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
TRUE 
 984 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>gva.cp <span class="ot">&lt;-</span> gva.cp <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    personcounts <span class="sc">%&gt;%</span> <span class="fu">select</span>(region, year, personcount),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'region'</span>,<span class="st">'year'</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">gva_per_capita =</span> (gva <span class="sc">/</span> personcount) <span class="sc">*</span> <span class="dv">1000000</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Add in region labels as before</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>gva.cp <span class="ot">&lt;-</span> gva.cp <span class="sc">%&gt;%</span> </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ns_england_restofUK =</span> <span class="fu">case_when</span>(</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">%in%</span> north <span class="sc">~</span> <span class="st">'North England'</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">%in%</span> south <span class="sc">~</span> <span class="st">'South Eng (inc. London)'</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">'rest of UK'</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Check full match</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(gva.cp<span class="sc">$</span>ns_england_restofUK, <span class="at">useNA =</span> <span class="st">'always'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
          North England              rest of UK South Eng (inc. London) 
                    264                     192                     528 
                   &lt;NA&gt; 
                      0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>gva.cp <span class="ot">&lt;-</span> gva.cp <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ns_england_restofUK_londonseparate =</span> <span class="fu">case_when</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">%in%</span> north <span class="sc">~</span> <span class="st">'North England'</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">%in%</span> south.minus.london <span class="sc">~</span> <span class="st">'South Eng (exc. London)'</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">'london'</span>,region,<span class="at">ignore.case =</span> T) <span class="sc">~</span> <span class="st">'London'</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">'rest of UK'</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(gva.cp<span class="sc">$</span>ns_england_restofUK_londonseparate, <span class="at">useNA =</span> <span class="st">'always'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                 London           North England              rest of UK 
                    120                     264                     192 
South Eng (exc. London)                    &lt;NA&gt; 
                    408                       0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#And a category for 'UK minus London'</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>gva.cp <span class="ot">&lt;-</span> gva.cp <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">UK_minus_london =</span> <span class="fu">case_when</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">'london'</span>,region,<span class="at">ignore.case =</span> T) <span class="sc">~</span> <span class="st">'London'</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">'UK minus London'</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(gva.cp<span class="sc">$</span>UK_minus_london, <span class="at">useNA =</span> <span class="st">'always'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
         London UK minus London            &lt;NA&gt; 
            120             864               0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Changing ranks</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>gva.cp <span class="ot">&lt;-</span> gva.cp <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(gva_per_capita))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#3 year smoothing</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>gva.cp <span class="ot">&lt;-</span> gva.cp <span class="sc">%&gt;%</span> </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">movingav =</span> <span class="fu">rollapply</span>(gva_per_capita,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank_movingav =</span> <span class="fu">rollapply</span>(rank,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Highlight South Yorkshire</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>gva.cp <span class="ot">&lt;-</span> gva.cp <span class="sc">%&gt;%</span> </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">selectedregion =</span> region <span class="sc">==</span> <span class="st">'South Yorkshire'</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot: first coalition years to pre covid</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gva.cp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1999</span>,<span class="dv">2006</span>,<span class="dv">2012</span>,<span class="dv">2018</span>)), <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year), <span class="at">y =</span> rank_movingav, <span class="at">group =</span> region, <span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region), <span class="at">color =</span> <span class="st">"grey44"</span>) <span class="sc">+</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> selectedregion, <span class="at">size =</span> selectedregion)) <span class="sc">+</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(ns_england_restofUK_londonseparate), <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'rank (3 year average)'</span>) <span class="sc">+</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'year (average centre)'</span>) <span class="sc">+</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="st">"none"</span>, <span class="at">shape =</span> <span class="st">"none"</span>, <span class="at">size =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">'region'</span>,<span class="st">'rank_movingav'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-7fc3a6f4b8da638ad54a" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-7fc3a6f4b8da638ad54a">{"x":{"data":[{"x":[1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4],"y":[40,40,40,40,null,41,41,41,41,null,13.666666666666666,9.6666666666666661,6,4.333333333333333,null,31.333333333333332,31.333333333333332,26.333333333333332,22,null,38,37.333333333333336,36.333333333333336,36],"text":["rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav: 40.000000<br />region: Inner London - East",null,"rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 41.000000<br />region: Inner London - West",null,"rank_movingav: 13.666667<br />region: Outer London - East and North East","rank_movingav:  9.666667<br />region: Outer London - East and North East","rank_movingav:  6.000000<br />region: Outer London - East and North East","rank_movingav:  4.333333<br />region: Outer London - East and North East",null,"rank_movingav: 31.333333<br />region: Outer London - South","rank_movingav: 31.333333<br />region: Outer London - South","rank_movingav: 26.333333<br />region: Outer London - South","rank_movingav: 22.000000<br />region: Outer London - South",null,"rank_movingav: 38.000000<br />region: Outer London - West and North West","rank_movingav: 37.333333<br />region: Outer London - West and North West","rank_movingav: 36.333333<br />region: Outer London - West and North West","rank_movingav: 36.000000<br />region: Outer London - West and North West"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4],"y":[35.333333333333336,36,36.666666666666664,38,null,18.666666666666668,16.333333333333332,20.666666666666668,18.666666666666668,null,9.6666666666666661,13.333333333333334,9.3333333333333339,12,null,20,24,22.333333333333332,28,null,14.666666666666666,13.666666666666666,12.333333333333334,13.666666666666666,null,5,8.3333333333333339,11,9,null,28.333333333333332,29,29.666666666666668,27,null,7.333333333333333,14,16.333333333333332,12.333333333333334,null,3.3333333333333335,5,4,3,null,3.6666666666666665,3,3,2,null,22.666666666666668,24.666666666666668,20.333333333333332,21],"text":["rank_movingav: 35.333333<br />region: Cheshire","rank_movingav: 36.000000<br />region: Cheshire","rank_movingav: 36.666667<br />region: Cheshire","rank_movingav: 38.000000<br />region: Cheshire",null,"rank_movingav: 18.666667<br />region: Cumbria","rank_movingav: 16.333333<br />region: Cumbria","rank_movingav: 20.666667<br />region: Cumbria","rank_movingav: 18.666667<br />region: Cumbria",null,"rank_movingav:  9.666667<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav: 13.333333<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav:  9.333333<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav: 12.000000<br />region: East Yorkshire and Northern Lincolnshire",null,"rank_movingav: 20.000000<br />region: Greater Manchester","rank_movingav: 24.000000<br />region: Greater Manchester","rank_movingav: 22.333333<br />region: Greater Manchester","rank_movingav: 28.000000<br />region: Greater Manchester",null,"rank_movingav: 14.666667<br />region: Lancashire","rank_movingav: 13.666667<br />region: Lancashire","rank_movingav: 12.333333<br />region: Lancashire","rank_movingav: 13.666667<br />region: Lancashire",null,"rank_movingav:  5.000000<br />region: Merseyside","rank_movingav:  8.333333<br />region: Merseyside","rank_movingav: 11.000000<br />region: Merseyside","rank_movingav:  9.000000<br />region: Merseyside",null,"rank_movingav: 28.333333<br />region: North Yorkshire","rank_movingav: 29.000000<br />region: North Yorkshire","rank_movingav: 29.666667<br />region: North Yorkshire","rank_movingav: 27.000000<br />region: North Yorkshire",null,"rank_movingav:  7.333333<br />region: Northumberland, and Tyne and Wear","rank_movingav: 14.000000<br />region: Northumberland, and Tyne and Wear","rank_movingav: 16.333333<br />region: Northumberland, and Tyne and Wear","rank_movingav: 12.333333<br />region: Northumberland, and Tyne and Wear",null,"rank_movingav:  3.333333<br />region: South Yorkshire","rank_movingav:  5.000000<br />region: South Yorkshire","rank_movingav:  4.000000<br />region: South Yorkshire","rank_movingav:  3.000000<br />region: South Yorkshire",null,"rank_movingav:  3.666667<br />region: Tees Valley and Durham","rank_movingav:  3.000000<br />region: Tees Valley and Durham","rank_movingav:  3.000000<br />region: Tees Valley and Durham","rank_movingav:  2.000000<br />region: Tees Valley and Durham",null,"rank_movingav: 22.666667<br />region: West Yorkshire","rank_movingav: 24.666667<br />region: West Yorkshire","rank_movingav: 20.333333<br />region: West Yorkshire","rank_movingav: 21.000000<br />region: West Yorkshire"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4],"y":[24.666666666666668,26,25.666666666666668,25.333333333333332,null,29,30,31.333333333333332,31,null,13.666666666666666,20.666666666666668,25,24.333333333333332,null,37,37.666666666666664,39,37,null,9.3333333333333339,14.333333333333334,10.333333333333334,13.666666666666666,null,6,5.333333333333333,5.666666666666667,6.333333333333333,null,21,28,27.333333333333332,27.666666666666668,null,1,1,1,1],"text":["rank_movingav: 24.666667<br />region: East Wales","rank_movingav: 26.000000<br />region: East Wales","rank_movingav: 25.666667<br />region: East Wales","rank_movingav: 25.333333<br />region: East Wales",null,"rank_movingav: 29.000000<br />region: Eastern Scotland","rank_movingav: 30.000000<br />region: Eastern Scotland","rank_movingav: 31.333333<br />region: Eastern Scotland","rank_movingav: 31.000000<br />region: Eastern Scotland",null,"rank_movingav: 13.666667<br />region: Highlands and Islands","rank_movingav: 20.666667<br />region: Highlands and Islands","rank_movingav: 25.000000<br />region: Highlands and Islands","rank_movingav: 24.333333<br />region: Highlands and Islands",null,"rank_movingav: 37.000000<br />region: North Eastern Scotland","rank_movingav: 37.666667<br />region: North Eastern Scotland","rank_movingav: 39.000000<br />region: North Eastern Scotland","rank_movingav: 37.000000<br />region: North Eastern Scotland",null,"rank_movingav:  9.333333<br />region: Northern Ireland","rank_movingav: 14.333333<br />region: Northern Ireland","rank_movingav: 10.333333<br />region: Northern Ireland","rank_movingav: 13.666667<br />region: Northern Ireland",null,"rank_movingav:  6.000000<br />region: Southern Scotland","rank_movingav:  5.333333<br />region: Southern Scotland","rank_movingav:  5.666667<br />region: Southern Scotland","rank_movingav:  6.333333<br />region: Southern Scotland",null,"rank_movingav: 21.000000<br />region: West Central Scotland","rank_movingav: 28.000000<br />region: West Central Scotland","rank_movingav: 27.333333<br />region: West Central Scotland","rank_movingav: 27.666667<br />region: West Central Scotland",null,"rank_movingav:  1.000000<br />region: West Wales and The Valleys","rank_movingav:  1.000000<br />region: West Wales and The Valleys","rank_movingav:  1.000000<br />region: West Wales and The Valleys","rank_movingav:  1.000000<br />region: West Wales and The Valleys"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4,null,1,2,3,4],"y":[35,35,31.666666666666668,34.666666666666664,null,39,39,38,39,null,2,2,2,4.666666666666667,null,15,11.333333333333334,16,13.333333333333334,null,9.3333333333333339,8.6666666666666661,12,9.3333333333333339,null,19,15.666666666666666,15.666666666666666,16,null,28,27,27.333333333333332,26.666666666666668,null,17.666666666666668,18,14,19.333333333333332,null,33,33.666666666666664,34.666666666666664,34.333333333333336,null,31.666666666666668,31.666666666666668,33.333333333333336,32,null,28.333333333333332,22.333333333333332,27.666666666666668,30,null,21.333333333333332,18.333333333333332,18.666666666666668,17.666666666666668,null,26.333333333333332,23,22.666666666666668,23,null,10.666666666666666,4.666666666666667,6.333333333333333,6.666666666666667,null,11.666666666666666,7.333333333333333,8,8.6666666666666661,null,34.666666666666664,33.333333333333336,34,33,null,24,20.333333333333332,18.333333333333332,18.333333333333332],"text":["rank_movingav: 35.000000<br />region: Bedfordshire and Hertfordshire","rank_movingav: 35.000000<br />region: Bedfordshire and Hertfordshire","rank_movingav: 31.666667<br />region: Bedfordshire and Hertfordshire","rank_movingav: 34.666667<br />region: Bedfordshire and Hertfordshire",null,"rank_movingav: 39.000000<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 39.000000<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 38.000000<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 39.000000<br />region: Berkshire, Buckinghamshire and Oxfordshire",null,"rank_movingav:  2.000000<br />region: Cornwall and Isles of Scilly","rank_movingav:  2.000000<br />region: Cornwall and Isles of Scilly","rank_movingav:  2.000000<br />region: Cornwall and Isles of Scilly","rank_movingav:  4.666667<br />region: Cornwall and Isles of Scilly",null,"rank_movingav: 15.000000<br />region: Derbyshire and Nottinghamshire","rank_movingav: 11.333333<br />region: Derbyshire and Nottinghamshire","rank_movingav: 16.000000<br />region: Derbyshire and Nottinghamshire","rank_movingav: 13.333333<br />region: Derbyshire and Nottinghamshire",null,"rank_movingav:  9.333333<br />region: Devon","rank_movingav:  8.666667<br />region: Devon","rank_movingav: 12.000000<br />region: Devon","rank_movingav:  9.333333<br />region: Devon",null,"rank_movingav: 19.000000<br />region: Dorset and Somerset","rank_movingav: 15.666667<br />region: Dorset and Somerset","rank_movingav: 15.666667<br />region: Dorset and Somerset","rank_movingav: 16.000000<br />region: Dorset and Somerset",null,"rank_movingav: 28.000000<br />region: East Anglia","rank_movingav: 27.000000<br />region: East Anglia","rank_movingav: 27.333333<br />region: East Anglia","rank_movingav: 26.666667<br />region: East Anglia",null,"rank_movingav: 17.666667<br />region: Essex","rank_movingav: 18.000000<br />region: Essex","rank_movingav: 14.000000<br />region: Essex","rank_movingav: 19.333333<br />region: Essex",null,"rank_movingav: 33.000000<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav: 33.666667<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav: 34.666667<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav: 34.333333<br />region: Gloucestershire, Wiltshire and Bath/Bristol area",null,"rank_movingav: 31.666667<br />region: Hampshire and Isle of Wight","rank_movingav: 31.666667<br />region: Hampshire and Isle of Wight","rank_movingav: 33.333333<br />region: Hampshire and Isle of Wight","rank_movingav: 32.000000<br />region: Hampshire and Isle of Wight",null,"rank_movingav: 28.333333<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav: 22.333333<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav: 27.666667<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav: 30.000000<br />region: Herefordshire, Worcestershire and Warwickshire",null,"rank_movingav: 21.333333<br />region: Kent","rank_movingav: 18.333333<br />region: Kent","rank_movingav: 18.666667<br />region: Kent","rank_movingav: 17.666667<br />region: Kent",null,"rank_movingav: 26.333333<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav: 23.000000<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav: 22.666667<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav: 23.000000<br />region: Leicestershire, Rutland and Northamptonshire",null,"rank_movingav: 10.666667<br />region: Lincolnshire","rank_movingav:  4.666667<br />region: Lincolnshire","rank_movingav:  6.333333<br />region: Lincolnshire","rank_movingav:  6.666667<br />region: Lincolnshire",null,"rank_movingav: 11.666667<br />region: Shropshire and Staffordshire","rank_movingav:  7.333333<br />region: Shropshire and Staffordshire","rank_movingav:  8.000000<br />region: Shropshire and Staffordshire","rank_movingav:  8.666667<br />region: Shropshire and Staffordshire",null,"rank_movingav: 34.666667<br />region: Surrey, East and West Sussex","rank_movingav: 33.333333<br />region: Surrey, East and West Sussex","rank_movingav: 34.000000<br />region: Surrey, East and West Sussex","rank_movingav: 33.000000<br />region: Surrey, East and West Sussex",null,"rank_movingav: 24.000000<br />region: West Midlands","rank_movingav: 20.333333<br />region: West Midlands","rank_movingav: 18.333333<br />region: West Midlands","rank_movingav: 18.333333<br />region: West Midlands"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3,3,3,3,3],"y":[41,40,6,26.333333333333332,36.333333333333336],"text":["rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav:  6.000000<br />region: Outer London - East and North East","rank_movingav: 26.333333<br />region: Outer London - South","rank_movingav: 36.333333<br />region: Outer London - West and North West"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3,3,3,3,3,3,3,3,3,3],"y":[3,16.333333333333332,20.666666666666668,22.333333333333332,12.333333333333334,36.666666666666664,11,9.3333333333333339,29.666666666666668,20.333333333333332],"text":["rank_movingav:  3.000000<br />region: Tees Valley and Durham","rank_movingav: 16.333333<br />region: Northumberland, and Tyne and Wear","rank_movingav: 20.666667<br />region: Cumbria","rank_movingav: 22.333333<br />region: Greater Manchester","rank_movingav: 12.333333<br />region: Lancashire","rank_movingav: 36.666667<br />region: Cheshire","rank_movingav: 11.000000<br />region: Merseyside","rank_movingav:  9.333333<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav: 29.666667<br />region: North Yorkshire","rank_movingav: 20.333333<br />region: West Yorkshire"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3,3,3,3,3,3,3,3],"y":[1,25.666666666666668,39,25,31.333333333333332,27.333333333333332,5.666666666666667,10.333333333333334],"text":["rank_movingav:  1.000000<br />region: West Wales and The Valleys","rank_movingav: 25.666667<br />region: East Wales","rank_movingav: 39.000000<br />region: North Eastern Scotland","rank_movingav: 25.000000<br />region: Highlands and Islands","rank_movingav: 31.333333<br />region: Eastern Scotland","rank_movingav: 27.333333<br />region: West Central Scotland","rank_movingav:  5.666667<br />region: Southern Scotland","rank_movingav: 10.333333<br />region: Northern Ireland"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],"y":[16,22.666666666666668,6.333333333333333,27.666666666666668,8,18.333333333333332,27.333333333333332,31.666666666666668,14,38,34,33.333333333333336,18.666666666666668,34.666666666666664,15.666666666666666,2,12],"text":["rank_movingav: 16.000000<br />region: Derbyshire and Nottinghamshire","rank_movingav: 22.666667<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav:  6.333333<br />region: Lincolnshire","rank_movingav: 27.666667<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav:  8.000000<br />region: Shropshire and Staffordshire","rank_movingav: 18.333333<br />region: West Midlands","rank_movingav: 27.333333<br />region: East Anglia","rank_movingav: 31.666667<br />region: Bedfordshire and Hertfordshire","rank_movingav: 14.000000<br />region: Essex","rank_movingav: 38.000000<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 34.000000<br />region: Surrey, East and West Sussex","rank_movingav: 33.333333<br />region: Hampshire and Isle of Wight","rank_movingav: 18.666667<br />region: Kent","rank_movingav: 34.666667<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav: 15.666667<br />region: Dorset and Somerset","rank_movingav:  2.000000<br />region: Cornwall and Isles of Scilly","rank_movingav: 12.000000<br />region: Devon"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3],"y":[4],"text":"rank_movingav:  4.000000<br />region: South Yorkshire","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":22.677165354330711,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2],"y":[41,40,9.6666666666666661,31.333333333333332,37.333333333333336],"text":["rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav:  9.666667<br />region: Outer London - East and North East","rank_movingav: 31.333333<br />region: Outer London - South","rank_movingav: 37.333333<br />region: Outer London - West and North West"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(124,174,0,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(124,174,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2,2,2,2,2,2],"y":[3,14,16.333333333333332,24,13.666666666666666,36,8.3333333333333339,13.333333333333334,29,24.666666666666668],"text":["rank_movingav:  3.000000<br />region: Tees Valley and Durham","rank_movingav: 14.000000<br />region: Northumberland, and Tyne and Wear","rank_movingav: 16.333333<br />region: Cumbria","rank_movingav: 24.000000<br />region: Greater Manchester","rank_movingav: 13.666667<br />region: Lancashire","rank_movingav: 36.000000<br />region: Cheshire","rank_movingav:  8.333333<br />region: Merseyside","rank_movingav: 13.333333<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav: 29.000000<br />region: North Yorkshire","rank_movingav: 24.666667<br />region: West Yorkshire"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(124,174,0,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(124,174,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2,2,2,2],"y":[1,26,37.666666666666664,20.666666666666668,30,28,5.333333333333333,14.333333333333334],"text":["rank_movingav:  1.000000<br />region: West Wales and The Valleys","rank_movingav: 26.000000<br />region: East Wales","rank_movingav: 37.666667<br />region: North Eastern Scotland","rank_movingav: 20.666667<br />region: Highlands and Islands","rank_movingav: 30.000000<br />region: Eastern Scotland","rank_movingav: 28.000000<br />region: West Central Scotland","rank_movingav:  5.333333<br />region: Southern Scotland","rank_movingav: 14.333333<br />region: Northern Ireland"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(124,174,0,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(124,174,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"y":[11.333333333333334,23,4.666666666666667,22.333333333333332,7.333333333333333,20.333333333333332,27,35,18,39,33.333333333333336,31.666666666666668,18.333333333333332,33.666666666666664,15.666666666666666,2,8.6666666666666661],"text":["rank_movingav: 11.333333<br />region: Derbyshire and Nottinghamshire","rank_movingav: 23.000000<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav:  4.666667<br />region: Lincolnshire","rank_movingav: 22.333333<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav:  7.333333<br />region: Shropshire and Staffordshire","rank_movingav: 20.333333<br />region: West Midlands","rank_movingav: 27.000000<br />region: East Anglia","rank_movingav: 35.000000<br />region: Bedfordshire and Hertfordshire","rank_movingav: 18.000000<br />region: Essex","rank_movingav: 39.000000<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 33.333333<br />region: Surrey, East and West Sussex","rank_movingav: 31.666667<br />region: Hampshire and Isle of Wight","rank_movingav: 18.333333<br />region: Kent","rank_movingav: 33.666667<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav: 15.666667<br />region: Dorset and Somerset","rank_movingav:  2.000000<br />region: Cornwall and Isles of Scilly","rank_movingav:  8.666667<br />region: Devon"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(124,174,0,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(124,174,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2],"y":[5],"text":"rank_movingav:  5.000000<br />region: South Yorkshire","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(124,174,0,1)","opacity":1,"size":22.677165354330711,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(124,174,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[4,4,4,4,4],"y":[41,40,4.333333333333333,22,36],"text":["rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav:  4.333333<br />region: Outer London - East and North East","rank_movingav: 22.000000<br />region: Outer London - South","rank_movingav: 36.000000<br />region: Outer London - West and North West"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(199,124,255,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(199,124,255,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[4,4,4,4,4,4,4,4,4,4],"y":[2,12.333333333333334,18.666666666666668,28,13.666666666666666,38,9,12,27,21],"text":["rank_movingav:  2.000000<br />region: Tees Valley and Durham","rank_movingav: 12.333333<br />region: Northumberland, and Tyne and Wear","rank_movingav: 18.666667<br />region: Cumbria","rank_movingav: 28.000000<br />region: Greater Manchester","rank_movingav: 13.666667<br />region: Lancashire","rank_movingav: 38.000000<br />region: Cheshire","rank_movingav:  9.000000<br />region: Merseyside","rank_movingav: 12.000000<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav: 27.000000<br />region: North Yorkshire","rank_movingav: 21.000000<br />region: West Yorkshire"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(199,124,255,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(199,124,255,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[4,4,4,4,4,4,4,4],"y":[1,25.333333333333332,37,24.333333333333332,31,27.666666666666668,6.333333333333333,13.666666666666666],"text":["rank_movingav:  1.000000<br />region: West Wales and The Valleys","rank_movingav: 25.333333<br />region: East Wales","rank_movingav: 37.000000<br />region: North Eastern Scotland","rank_movingav: 24.333333<br />region: Highlands and Islands","rank_movingav: 31.000000<br />region: Eastern Scotland","rank_movingav: 27.666667<br />region: West Central Scotland","rank_movingav:  6.333333<br />region: Southern Scotland","rank_movingav: 13.666667<br />region: Northern Ireland"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(199,124,255,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(199,124,255,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],"y":[13.333333333333334,23,6.666666666666667,30,8.6666666666666661,18.333333333333332,26.666666666666668,34.666666666666664,19.333333333333332,39,33,32,17.666666666666668,34.333333333333336,16,4.666666666666667,9.3333333333333339],"text":["rank_movingav: 13.333333<br />region: Derbyshire and Nottinghamshire","rank_movingav: 23.000000<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav:  6.666667<br />region: Lincolnshire","rank_movingav: 30.000000<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav:  8.666667<br />region: Shropshire and Staffordshire","rank_movingav: 18.333333<br />region: West Midlands","rank_movingav: 26.666667<br />region: East Anglia","rank_movingav: 34.666667<br />region: Bedfordshire and Hertfordshire","rank_movingav: 19.333333<br />region: Essex","rank_movingav: 39.000000<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 33.000000<br />region: Surrey, East and West Sussex","rank_movingav: 32.000000<br />region: Hampshire and Isle of Wight","rank_movingav: 17.666667<br />region: Kent","rank_movingav: 34.333333<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav: 16.000000<br />region: Dorset and Somerset","rank_movingav:  4.666667<br />region: Cornwall and Isles of Scilly","rank_movingav:  9.333333<br />region: Devon"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(199,124,255,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(199,124,255,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[4],"y":[3],"text":"rank_movingav:  3.000000<br />region: South Yorkshire","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(199,124,255,1)","opacity":1,"size":22.677165354330711,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(199,124,255,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1],"y":[41,40,13.666666666666666,31.333333333333332,38],"text":["rank_movingav: 41.000000<br />region: Inner London - West","rank_movingav: 40.000000<br />region: Inner London - East","rank_movingav: 13.666667<br />region: Outer London - East and North East","rank_movingav: 31.333333<br />region: Outer London - South","rank_movingav: 38.000000<br />region: Outer London - West and North West"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1,1,1,1,1,1],"y":[3.6666666666666665,7.333333333333333,18.666666666666668,20,14.666666666666666,35.333333333333336,5,9.6666666666666661,28.333333333333332,22.666666666666668],"text":["rank_movingav:  3.666667<br />region: Tees Valley and Durham","rank_movingav:  7.333333<br />region: Northumberland, and Tyne and Wear","rank_movingav: 18.666667<br />region: Cumbria","rank_movingav: 20.000000<br />region: Greater Manchester","rank_movingav: 14.666667<br />region: Lancashire","rank_movingav: 35.333333<br />region: Cheshire","rank_movingav:  5.000000<br />region: Merseyside","rank_movingav:  9.666667<br />region: East Yorkshire and Northern Lincolnshire","rank_movingav: 28.333333<br />region: North Yorkshire","rank_movingav: 22.666667<br />region: West Yorkshire"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1,1,1,1],"y":[1,24.666666666666668,37,13.666666666666666,29,21,6,9.3333333333333339],"text":["rank_movingav:  1.000000<br />region: West Wales and The Valleys","rank_movingav: 24.666667<br />region: East Wales","rank_movingav: 37.000000<br />region: North Eastern Scotland","rank_movingav: 13.666667<br />region: Highlands and Islands","rank_movingav: 29.000000<br />region: Eastern Scotland","rank_movingav: 21.000000<br />region: West Central Scotland","rank_movingav:  6.000000<br />region: Southern Scotland","rank_movingav:  9.333333<br />region: Northern Ireland"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"y":[15,26.333333333333332,10.666666666666666,28.333333333333332,11.666666666666666,24,28,35,17.666666666666668,39,34.666666666666664,31.666666666666668,21.333333333333332,33,19,2,9.3333333333333339],"text":["rank_movingav: 15.000000<br />region: Derbyshire and Nottinghamshire","rank_movingav: 26.333333<br />region: Leicestershire, Rutland and Northamptonshire","rank_movingav: 10.666667<br />region: Lincolnshire","rank_movingav: 28.333333<br />region: Herefordshire, Worcestershire and Warwickshire","rank_movingav: 11.666667<br />region: Shropshire and Staffordshire","rank_movingav: 24.000000<br />region: West Midlands","rank_movingav: 28.000000<br />region: East Anglia","rank_movingav: 35.000000<br />region: Bedfordshire and Hertfordshire","rank_movingav: 17.666667<br />region: Essex","rank_movingav: 39.000000<br />region: Berkshire, Buckinghamshire and Oxfordshire","rank_movingav: 34.666667<br />region: Surrey, East and West Sussex","rank_movingav: 31.666667<br />region: Hampshire and Isle of Wight","rank_movingav: 21.333333<br />region: Kent","rank_movingav: 33.000000<br />region: Gloucestershire, Wiltshire and Bath/Bristol area","rank_movingav: 19.000000<br />region: Dorset and Somerset","rank_movingav:  2.000000<br />region: Cornwall and Isles of Scilly","rank_movingav:  9.333333<br />region: Devon"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1],"y":[3.3333333333333335],"text":"rank_movingav:  3.333333<br />region: South Yorkshire","type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":22.677165354330711,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":37.917808219178085,"r":7.3059360730593621,"b":40.182648401826491,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,0.24592302674494454],"automargin":true,"type":"linear","autorange":false,"range":[0.40000000000000002,4.5999999999999996],"tickmode":"array","ticktext":["1999","2006","2012","2018"],"tickvals":[1,2,3,4],"categoryorder":"array","categoryarray":["1999","2006","2012","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"year (average centre)","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.917808219178088},{"text":"rank (3 year average)","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-21.917808219178081},{"text":"London","x":0.12296151337247227,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.68949771689498},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"North England","x":0.375,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.68949771689498},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"rest of UK","x":0.625,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.68949771689498},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"South Eng (exc. London)","x":0.8770384866275277,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.68949771689498},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1,43],"tickmode":"array","ticktext":["0","10","20","30","40"],"tickvals":[0,10,20,30,40],"categoryorder":"array","categoryarray":["0","10","20","30","40"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.24592302674494454,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.24592302674494454,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.25407697325505546,"x1":0.49592302674494454,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.25407697325505546,"x1":0.49592302674494454,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.5040769732550554,"x1":0.7459230267449446,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.5040769732550554,"x1":0.7459230267449446,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.7540769732550554,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.7540769732550554,"x1":1,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.40000000000000002,4.5999999999999996],"tickmode":"array","ticktext":["1999","2006","2012","2018"],"tickvals":[1,2,3,4],"categoryorder":"array","categoryarray":["1999","2006","2012","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.25407697325505546,0.49592302674494454],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"xaxis3":{"type":"linear","autorange":false,"range":[0.40000000000000002,4.5999999999999996],"tickmode":"array","ticktext":["1999","2006","2012","2018"],"tickvals":[1,2,3,4],"categoryorder":"array","categoryarray":["1999","2006","2012","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.5040769732550554,0.7459230267449446],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"xaxis4":{"type":"linear","autorange":false,"range":[0.40000000000000002,4.5999999999999996],"tickmode":"array","ticktext":["1999","2006","2012","2018"],"tickvals":[1,2,3,4],"categoryorder":"array","categoryarray":["1999","2006","2012","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.7540769732550554,1],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"15e6b32c663b3":{"x":{},"y":{},"colour":{},"type":"scatter"},"15e6b9c4a0f7":{"x":{},"y":{},"colour":{},"shape":{},"size":{}}},"cur_data":"15e6b32c663b3","visdat":{"15e6b32c663b3":["function (y) ","x"],"15e6b9c4a0f7":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="proportion-diffs-for-itl2-gva-per-capita" class="level2">
<h2 class="anchored" data-anchor-id="proportion-diffs-for-itl2-gva-per-capita">PROPORTION DIFFS FOR ITL2 GVA PER CAPITA</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#For region grouping... Weight averages by population</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>weightedaverages.gva.cp.regions <span class="ot">&lt;-</span> gva.cp <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region_grouping =</span> ns_england_restofUK_londonseparate) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_grouping,year) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">weighted_mean_gva =</span> <span class="fu">weighted.mean</span>(gva_per_capita, personcount, <span class="at">na.rm=</span>T)<span class="co">#get weighted average by each ITL2 grouping</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co">#merge in SY values</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(gva.cp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">'South Yorkshire'</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">SY_gva =</span> gva_per_capita), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>))  </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Repeat for MCA average minus SY</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>weightedaverages.gva.cp.mcas <span class="ot">&lt;-</span> gva.cp <span class="sc">%&gt;%</span> </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region_grouping =</span> <span class="fu">ifelse</span>(region <span class="sc">%in%</span> mcas[mcas<span class="sc">!=</span><span class="st">'South Yorkshire'</span>], <span class="st">'MCAs exc. SY'</span>,<span class="st">'Other'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_grouping,year) <span class="sc">%&gt;%</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">weighted_mean_gva =</span> <span class="fu">weighted.mean</span>(gva_per_capita, personcount, <span class="at">na.rm=</span>T)<span class="co">#get weighted average by each ITL2 grouping</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co">#merge in SY values</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(gva.cp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">'South Yorkshire'</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">SY_gva =</span> gva_per_capita), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>))</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Append those two</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>weightedavs.gva.cp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  weightedaverages.gva.cp.regions,</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  weightedaverages.gva.cp.mcas <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region_grouping<span class="sc">!=</span><span class="st">'Other'</span>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="co">#Smooth</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>weightedavs.gva.cp <span class="ot">&lt;-</span> weightedavs.gva.cp <span class="sc">%&gt;%</span> </span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff =</span> (weighted_mean_gva <span class="sc">-</span> SY_gva)<span class="sc">/</span>SY_gva</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_grouping) <span class="sc">%&gt;%</span> </span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_3yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_5yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">5</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="co">#Plain prop diff in per capita numbers looks smoothed already / isn't reliant on small samples?</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(weightedavs.gva.cp, aes(x = year, y = prop_diff * 100, colour = region_grouping)) +</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weightedavs.gva.cp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region_grouping<span class="sc">!=</span><span class="st">'London'</span>), <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop_diff <span class="sc">*</span> <span class="dv">100</span>, <span class="at">colour =</span> region_grouping)) <span class="sc">+</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(weightedavs %&gt;% filter(region_grouping!='London', !is.na(prop_diff_5yrsmooth)), aes(x = year, y = prop_diff_5yrsmooth * 100, colour = region_grouping)) +</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(weightedavs, aes(x = year, y = prop_diff * 100, colour = region_grouping)) +</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_cartesian(ylim = c(-1,30)) +</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="gdp_gaps_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#COMPARE THE MCAS DIRECTLY</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#MCA to get proportion gaps to others</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>comparator <span class="ot">=</span> perhourworked.withtotalhours<span class="sc">$</span>region[<span class="fu">grepl</span>(<span class="st">'South Y'</span>, perhourworked.withtotalhours<span class="sc">$</span>region, <span class="at">ignore.case =</span> T)] <span class="sc">%&gt;%</span> unique</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># comparator = perhourworked.withtotalhours$region[grepl('Greater M', perhourworked.withtotalhours$region, ignore.case = T)] %&gt;% unique</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>mcacompare <span class="ot">&lt;-</span> gva.cp <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, year, gva_per_capita) <span class="sc">%&gt;%</span> </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> mcas[mcas<span class="sc">!=</span>comparator]) <span class="sc">%&gt;%</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    gva.cp <span class="sc">%&gt;%</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(region <span class="sc">==</span> comparator) <span class="sc">%&gt;%</span> </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(year, <span class="at">SY_gva =</span> gva_per_capita),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">'year'</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_diff =</span> (gva_per_capita <span class="sc">-</span> SY_gva)<span class="sc">/</span>SY_gva) <span class="sc">%&gt;%</span> </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_3yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_5yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">5</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(corecompare, aes(x = year, y = prop_diff_5yrsmooth * 100, colour = fct_reorder(region, prop_diff_5yrsmooth))) +</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mcacompare, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop_diff <span class="sc">*</span> <span class="dv">100</span>, <span class="at">colour =</span> <span class="fu">fct_reorder</span>(region, prop_diff))) <span class="sc">+</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_cartesian(ylim = c(-1,30)) +</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Paired'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="gdp_gaps_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="repeat-per-capita-for-itl3" class="level2">
<h2 class="anchored" data-anchor-id="repeat-per-capita-for-itl3">REPEAT PER CAPITA FOR ITL3</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get population numbers for per person figures</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#From regionalgrossvalueaddedbalancedbyindustryandallitlregions.xlsx</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ONS mid year population estimates</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Table 6 (not sure where they got consistent ITL2 geogs from...)</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>personcounts.itl3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/Table 6 Total resident population numbers persons.csv'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ITLcode =</span> <span class="st">`</span><span class="at">ITL code</span><span class="st">`</span>, <span class="at">region =</span> <span class="st">`</span><span class="at">Region name</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITL <span class="sc">==</span> <span class="st">'ITL3'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">1998</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2021</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">'year'</span>, <span class="at">values_to =</span> <span class="st">'personcount'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Total GVA in current basic prices from the same source</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>gva.cp.itl3 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/Table 1 GVA balanced at current basic prices millions.csv'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">ITLcode =</span> <span class="st">`</span><span class="at">ITL code</span><span class="st">`</span>, <span class="at">region =</span> <span class="st">`</span><span class="at">Region name</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ITL <span class="sc">==</span> <span class="st">'ITL3'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">1998</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2021</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">'year'</span>, <span class="at">values_to =</span> <span class="st">'gva'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Add person counts in to get GVA per capita</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Check link match... tick</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(personcounts.itl3<span class="sc">$</span>region <span class="sc">%in%</span> gva.cp.itl3<span class="sc">$</span>region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
TRUE 
4296 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>gva.cp.itl3 <span class="ot">&lt;-</span> gva.cp.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    personcounts.itl3 <span class="sc">%&gt;%</span> <span class="fu">select</span>(region, year, personcount),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'region'</span>,<span class="st">'year'</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">gva_per_capita =</span> (gva <span class="sc">/</span> personcount) <span class="sc">*</span> <span class="dv">1000000</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Use matching part ITL2 code to add region labels in</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>gva.cp.itl3 <span class="ot">&lt;-</span> gva.cp.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ITL2code =</span> <span class="fu">str_sub</span>(gva.cp.itl3<span class="sc">$</span>ITLcode,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">2</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Merge in region labels from the ITL2 data</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>gva.cp.itl3 <span class="ot">&lt;-</span> gva.cp.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    gva.cp <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(ITLcode, ns_england_restofUK, ns_england_restofUK_londonseparate) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">ITL2code =</span> ITLcode, ns_england_restofUK, ns_england_restofUK_londonseparate),</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">'ITL2code'</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Add in an extra one for the shortlist of 11 'core cities'</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Belfast, Birmingham, Bristol, Cardiff, Glasgow, Leeds, Liverpool, Manchester, Newcastle, Nottingham, Sheffield</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co">#https://www.corecities.com/about-us/what-core-cities-uk</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>gva.cp.itl3 <span class="ot">&lt;-</span> gva.cp.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">core_cities =</span> <span class="fu">ifelse</span>(region <span class="sc">%in%</span> corecities, <span class="st">'Core city'</span>, <span class="st">'Other'</span>),</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">core_cities_minus_sheffield =</span> <span class="fu">ifelse</span>(region <span class="sc">%in%</span> corecities[corecities<span class="sc">!=</span><span class="st">'Sheffield'</span>],<span class="st">'Core city (exc. Sheffield)'</span>,<span class="st">'Other'</span>)<span class="co">#without sheffield, so not including in weighted average</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a><span class="co">#Changing ranks</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>gva.cp.itl3 <span class="ot">&lt;-</span> gva.cp.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(gva_per_capita))</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a><span class="co">#3 year smoothing</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>gva.cp.itl3 <span class="ot">&lt;-</span> gva.cp.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">movingav =</span> <span class="fu">rollapply</span>(gva_per_capita,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">rank_movingav =</span> <span class="fu">rollapply</span>(rank,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>)</span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a><span class="co">#Highlight Sheffield and BDR</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>gva.cp.itl3 <span class="ot">&lt;-</span> gva.cp.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">selectedregion =</span> <span class="fu">grepl</span>(<span class="st">'Sheffield|Barnsley'</span>, region, <span class="at">ignore.case =</span> T))</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot: first coalition years to pre covid</span></span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a><span class="co"># p &lt;- ggplot(gva.cp.itl3 %&gt;% filter(year %in% c(1999,2006,2012,2018)), aes(x = factor(year), y = rank_movingav, group = region, color = factor(year))) +</span></span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gva.cp.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1999</span>,<span class="dv">2018</span>)), <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year), <span class="at">y =</span> rank_movingav, <span class="at">group =</span> region, <span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> region), <span class="at">color =</span> <span class="st">"grey44"</span>) <span class="sc">+</span></span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> selectedregion, <span class="at">size =</span> selectedregion)) <span class="sc">+</span></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(ns_england_restofUK_londonseparate), <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb32-61"><a href="#cb32-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">'rank (3 year average)'</span>) <span class="sc">+</span></span>
<span id="cb32-62"><a href="#cb32-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">'year (average centre)'</span>) <span class="sc">+</span></span>
<span id="cb32-63"><a href="#cb32-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="st">"none"</span>, <span class="at">shape =</span> <span class="st">"none"</span>, <span class="at">size =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb32-64"><a href="#cb32-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb32-65"><a href="#cb32-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-66"><a href="#cb32-66" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">'region'</span>,<span class="st">'rank_movingav'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-a1b8201b83faa7ee570f" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a1b8201b83faa7ee570f">{"x":{"data":[{"x":[1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2],"y":[97.333333333333329,44,null,102.33333333333333,79,null,94.666666666666671,79.333333333333329,null,136.33333333333334,122.66666666666667,null,122.66666666666667,98.666666666666671,null,179,179,null,125.33333333333333,106.66666666666667,null,136.33333333333334,126,null,107,86,null,71,95.333333333333329,null,170.66666666666666,171.33333333333334,null,172.66666666666666,159,null,174,175,null,172.66666666666666,176,null,157.33333333333334,165,null,150.33333333333334,164,null,141,116,null,31,7.333333333333333,null,177,177,null,73.333333333333329,96.666666666666671,null,178,178],"text":["rank_movingav:  97.333333<br />region: Barking & Dagenham and Havering","rank_movingav:  44.000000<br />region: Barking & Dagenham and Havering",null,"rank_movingav: 102.333333<br />region: Barnet","rank_movingav:  79.000000<br />region: Barnet",null,"rank_movingav:  94.666667<br />region: Bexley and Greenwich","rank_movingav:  79.333333<br />region: Bexley and Greenwich",null,"rank_movingav: 136.333333<br />region: Brent","rank_movingav: 122.666667<br />region: Brent",null,"rank_movingav: 122.666667<br />region: Bromley","rank_movingav:  98.666667<br />region: Bromley",null,"rank_movingav: 179.000000<br />region: Camden and City of London","rank_movingav: 179.000000<br />region: Camden and City of London",null,"rank_movingav: 125.333333<br />region: Croydon","rank_movingav: 106.666667<br />region: Croydon",null,"rank_movingav: 136.333333<br />region: Ealing","rank_movingav: 126.000000<br />region: Ealing",null,"rank_movingav: 107.000000<br />region: Enfield","rank_movingav:  86.000000<br />region: Enfield",null,"rank_movingav:  71.000000<br />region: Hackney and Newham","rank_movingav:  95.333333<br />region: Hackney and Newham",null,"rank_movingav: 170.666667<br />region: Haringey and Islington","rank_movingav: 171.333333<br />region: Haringey and Islington",null,"rank_movingav: 172.666667<br />region: Harrow and Hillingdon","rank_movingav: 159.000000<br />region: Harrow and Hillingdon",null,"rank_movingav: 174.000000<br />region: Hounslow and Richmond upon Thames","rank_movingav: 175.000000<br />region: Hounslow and Richmond upon Thames",null,"rank_movingav: 172.666667<br />region: Kensington & Chelsea and Hammersmith & Fulham","rank_movingav: 176.000000<br />region: Kensington & Chelsea and Hammersmith & Fulham",null,"rank_movingav: 157.333333<br />region: Lambeth","rank_movingav: 165.000000<br />region: Lambeth",null,"rank_movingav: 150.333333<br />region: Lewisham and Southwark","rank_movingav: 164.000000<br />region: Lewisham and Southwark",null,"rank_movingav: 141.000000<br />region: Merton, Kingston upon Thames and Sutton","rank_movingav: 116.000000<br />region: Merton, Kingston upon Thames and Sutton",null,"rank_movingav:  31.000000<br />region: Redbridge and Waltham Forest","rank_movingav:   7.333333<br />region: Redbridge and Waltham Forest",null,"rank_movingav: 177.000000<br />region: Tower Hamlets","rank_movingav: 177.000000<br />region: Tower Hamlets",null,"rank_movingav:  73.333333<br />region: Wandsworth","rank_movingav:  96.666667<br />region: Wandsworth",null,"rank_movingav: 178.000000<br />region: Westminster","rank_movingav: 178.000000<br />region: Westminster"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2],"y":[16.666666666666668,26,null,46.666666666666664,64.333333333333329,null,10.666666666666666,42,null,53,31,null,40.333333333333336,46.666666666666664,null,147,160.66666666666666,null,130.33333333333334,146.66666666666666,null,38,52.666666666666664,null,128,100.66666666666667,null,18,12.333333333333334,null,109.33333333333333,120.66666666666667,null,38.333333333333336,35.666666666666664,null,75.333333333333329,90.666666666666671,null,65.666666666666671,53,null,23,19.333333333333332,null,28.333333333333332,28.666666666666668,null,49.333333333333336,50,null,151.33333333333334,156,null,76.666666666666671,76.333333333333329,null,63.666666666666664,84.333333333333329,null,22.666666666666668,21,null,150.33333333333334,151.33333333333334,null,102.33333333333333,124.66666666666667,null,166,168.66666666666666,null,161.66666666666666,146.66666666666666,null,84.666666666666671,91.666666666666671,null,94,103.66666666666667,null,23,10.333333333333334,null,2,3.6666666666666665,null,73.666666666666671,74,null,22.666666666666668,14.333333333333334,null,63,115,null,71.666666666666671,90.333333333333329,null,91.666666666666671,77.666666666666671,null,160.33333333333334,162,null,77,67.333333333333329,null,4.666666666666667,7.333333333333333,null,153.66666666666666,139.33333333333334],"text":["rank_movingav:  16.666667<br />region: Barnsley, Doncaster and Rotherham","rank_movingav:  26.000000<br />region: Barnsley, Doncaster and Rotherham",null,"rank_movingav:  46.666667<br />region: Blackburn with Darwen","rank_movingav:  64.333333<br />region: Blackburn with Darwen",null,"rank_movingav:  10.666667<br />region: Blackpool","rank_movingav:  42.000000<br />region: Blackpool",null,"rank_movingav:  53.000000<br />region: Bradford","rank_movingav:  31.000000<br />region: Bradford",null,"rank_movingav:  40.333333<br />region: Calderdale and Kirklees","rank_movingav:  46.666667<br />region: Calderdale and Kirklees",null,"rank_movingav: 147.000000<br />region: Cheshire East","rank_movingav: 160.666667<br />region: Cheshire East",null,"rank_movingav: 130.333333<br />region: Cheshire West and Chester","rank_movingav: 146.666667<br />region: Cheshire West and Chester",null,"rank_movingav:  38.000000<br />region: Chorley and West Lancashire","rank_movingav:  52.666667<br />region: Chorley and West Lancashire",null,"rank_movingav: 128.000000<br />region: Darlington","rank_movingav: 100.666667<br />region: Darlington",null,"rank_movingav:  18.000000<br />region: Durham CC","rank_movingav:  12.333333<br />region: Durham CC",null,"rank_movingav: 109.333333<br />region: East Cumbria","rank_movingav: 120.666667<br />region: East Cumbria",null,"rank_movingav:  38.333333<br />region: East Lancashire","rank_movingav:  35.666667<br />region: East Lancashire",null,"rank_movingav:  75.333333<br />region: East Merseyside","rank_movingav:  90.666667<br />region: East Merseyside",null,"rank_movingav:  65.666667<br />region: East Riding of Yorkshire","rank_movingav:  53.000000<br />region: East Riding of Yorkshire",null,"rank_movingav:  23.000000<br />region: Greater Manchester North East","rank_movingav:  19.333333<br />region: Greater Manchester North East",null,"rank_movingav:  28.333333<br />region: Greater Manchester North West","rank_movingav:  28.666667<br />region: Greater Manchester North West",null,"rank_movingav:  49.333333<br />region: Greater Manchester South East","rank_movingav:  50.000000<br />region: Greater Manchester South East",null,"rank_movingav: 151.333333<br />region: Greater Manchester South West","rank_movingav: 156.000000<br />region: Greater Manchester South West",null,"rank_movingav:  76.666667<br />region: Hartlepool and Stockton-on-Tees","rank_movingav:  76.333333<br />region: Hartlepool and Stockton-on-Tees",null,"rank_movingav:  63.666667<br />region: Kingston upon Hull, City of","rank_movingav:  84.333333<br />region: Kingston upon Hull, City of",null,"rank_movingav:  22.666667<br />region: Lancaster and Wyre","rank_movingav:  21.000000<br />region: Lancaster and Wyre",null,"rank_movingav: 150.333333<br />region: Leeds","rank_movingav: 151.333333<br />region: Leeds",null,"rank_movingav: 102.333333<br />region: Liverpool","rank_movingav: 124.666667<br />region: Liverpool",null,"rank_movingav: 166.000000<br />region: Manchester","rank_movingav: 168.666667<br />region: Manchester",null,"rank_movingav: 161.666667<br />region: Mid Lancashire","rank_movingav: 146.666667<br />region: Mid Lancashire",null,"rank_movingav:  84.666667<br />region: North and North East Lincolnshire","rank_movingav:  91.666667<br />region: North and North East Lincolnshire",null,"rank_movingav:  94.000000<br />region: North Yorkshire CC","rank_movingav: 103.666667<br />region: North Yorkshire CC",null,"rank_movingav:  23.000000<br />region: Northumberland","rank_movingav:  10.333333<br />region: Northumberland",null,"rank_movingav:   2.000000<br />region: Sefton","rank_movingav:   3.666667<br />region: Sefton",null,"rank_movingav:  73.666667<br />region: Sheffield","rank_movingav:  74.000000<br />region: Sheffield",null,"rank_movingav:  22.666667<br />region: South Teesside","rank_movingav:  14.333333<br />region: South Teesside",null,"rank_movingav:  63.000000<br />region: Sunderland","rank_movingav: 115.000000<br />region: Sunderland",null,"rank_movingav:  71.666667<br />region: Tyneside","rank_movingav:  90.333333<br />region: Tyneside",null,"rank_movingav:  91.666667<br />region: Wakefield","rank_movingav:  77.666667<br />region: Wakefield",null,"rank_movingav: 160.333333<br />region: Warrington","rank_movingav: 162.000000<br />region: Warrington",null,"rank_movingav:  77.000000<br />region: West Cumbria","rank_movingav:  67.333333<br />region: West Cumbria",null,"rank_movingav:   4.666667<br />region: Wirral","rank_movingav:   7.333333<br />region: Wirral",null,"rank_movingav: 153.666667<br />region: York","rank_movingav: 139.333333<br />region: York"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2],"y":[155.66666666666666,157,null,49.333333333333336,65,null,88.666666666666671,87.666666666666671,null,1,1,null,26.666666666666668,31.333333333333332,null,150,163.66666666666666,null,50,43.666666666666664,null,52,70.666666666666671,null,121,130,null,11.333333333333334,4,null,8,23,null,166.66666666666666,171.66666666666666,null,39.333333333333336,47.333333333333336,null,12,20.666666666666668,null,12,35.333333333333336,null,92.333333333333329,95.666666666666671,null,13.333333333333334,8.3333333333333339,null,4,20,null,5.666666666666667,19,null,109,107.33333333333333,null,38,38,null,103.33333333333333,120,null,157.66666666666666,157.66666666666666,null,8.3333333333333339,6.666666666666667,null,43.666666666666664,44.333333333333336,null,33,38.333333333333336,null,100,125.66666666666667,null,3.6666666666666665,5.333333333333333,null,67.333333333333329,81.666666666666671,null,54,107.33333333333333,null,132.66666666666666,34,null,103.66666666666667,87.333333333333329,null,105.66666666666667,104.66666666666667,null,19.666666666666668,51.666666666666664,null,11.333333333333334,17.666666666666668,null,52,86,null,119,108,null,119,128.66666666666666,null,29.333333333333332,18.333333333333332,null,72.333333333333329,60,null,146.33333333333334,155.33333333333334,null,70.666666666666671,71.666666666666671,null,51.666666666666664,66,null,23.333333333333332,30.333333333333332,null,56.666666666666664,82.666666666666671,null,117,118.66666666666667],"text":["rank_movingav: 155.666667<br />region: Aberdeen City and Aberdeenshire","rank_movingav: 157.000000<br />region: Aberdeen City and Aberdeenshire",null,"rank_movingav:  49.333333<br />region: Angus and Dundee City","rank_movingav:  65.000000<br />region: Angus and Dundee City",null,"rank_movingav:  88.666667<br />region: Antrim and Newtownabbey","rank_movingav:  87.666667<br />region: Antrim and Newtownabbey",null,"rank_movingav:   1.000000<br />region: Ards and North Down","rank_movingav:   1.000000<br />region: Ards and North Down",null,"rank_movingav:  26.666667<br />region: Armagh City, Banbridge and Craigavon","rank_movingav:  31.333333<br />region: Armagh City, Banbridge and Craigavon",null,"rank_movingav: 150.000000<br />region: Belfast","rank_movingav: 163.666667<br />region: Belfast",null,"rank_movingav:  50.000000<br />region: Bridgend and Neath Port Talbot","rank_movingav:  43.666667<br />region: Bridgend and Neath Port Talbot",null,"rank_movingav:  52.000000<br />region: Caithness and Sutherland, and Ross and Cromarty","rank_movingav:  70.666667<br />region: Caithness and Sutherland, and Ross and Cromarty",null,"rank_movingav: 121.000000<br />region: Cardiff and Vale of Glamorgan","rank_movingav: 130.000000<br />region: Cardiff and Vale of Glamorgan",null,"rank_movingav:  11.333333<br />region: Causeway Coast and Glens","rank_movingav:   4.000000<br />region: Causeway Coast and Glens",null,"rank_movingav:   8.000000<br />region: Central Valleys","rank_movingav:  23.000000<br />region: Central Valleys",null,"rank_movingav: 166.666667<br />region: City of Edinburgh","rank_movingav: 171.666667<br />region: City of Edinburgh",null,"rank_movingav:  39.333333<br />region: Clackmannanshire and Fife","rank_movingav:  47.333333<br />region: Clackmannanshire and Fife",null,"rank_movingav:  12.000000<br />region: Conwy and Denbighshire","rank_movingav:  20.666667<br />region: Conwy and Denbighshire",null,"rank_movingav:  12.000000<br />region: Derry City and Strabane","rank_movingav:  35.333333<br />region: Derry City and Strabane",null,"rank_movingav:  92.333333<br />region: Dumfries and Galloway","rank_movingav:  95.666667<br />region: Dumfries and Galloway",null,"rank_movingav:  13.333333<br />region: East Ayrshire and North Ayrshire mainland","rank_movingav:   8.333333<br />region: East Ayrshire and North Ayrshire mainland",null,"rank_movingav:   4.000000<br />region: East Dunbartonshire, West Dunbartonshire, and Helensburgh and Lomond","rank_movingav:  20.000000<br />region: East Dunbartonshire, West Dunbartonshire, and Helensburgh and Lomond",null,"rank_movingav:   5.666667<br />region: East Lothian and Midlothian","rank_movingav:  19.000000<br />region: East Lothian and Midlothian",null,"rank_movingav: 109.000000<br />region: Falkirk","rank_movingav: 107.333333<br />region: Falkirk",null,"rank_movingav:  38.000000<br />region: Fermanagh and Omagh","rank_movingav:  38.000000<br />region: Fermanagh and Omagh",null,"rank_movingav: 103.333333<br />region: Flintshire and Wrexham","rank_movingav: 120.000000<br />region: Flintshire and Wrexham",null,"rank_movingav: 157.666667<br />region: Glasgow City","rank_movingav: 157.666667<br />region: Glasgow City",null,"rank_movingav:   8.333333<br />region: Gwent Valleys","rank_movingav:   6.666667<br />region: Gwent Valleys",null,"rank_movingav:  43.666667<br />region: Gwynedd","rank_movingav:  44.333333<br />region: Gwynedd",null,"rank_movingav:  33.000000<br />region: Inverclyde, East Renfrewshire, and Renfrewshire","rank_movingav:  38.333333<br />region: Inverclyde, East Renfrewshire, and Renfrewshire",null,"rank_movingav: 100.000000<br />region: Inverness and Nairn, Moray, Badenoch and Strathspey","rank_movingav: 125.666667<br />region: Inverness and Nairn, Moray, Badenoch and Strathspey",null,"rank_movingav:   3.666667<br />region: Isle of Anglesey","rank_movingav:   5.333333<br />region: Isle of Anglesey",null,"rank_movingav:  67.333333<br />region: Lisburn and Castlereagh","rank_movingav:  81.666667<br />region: Lisburn and Castlereagh",null,"rank_movingav:  54.000000<br />region: Lochaber, Skye and Lochalsh, Arran and Cumbrae, and Argyll and Bute","rank_movingav: 107.333333<br />region: Lochaber, Skye and Lochalsh, Arran and Cumbrae, and Argyll and Bute",null,"rank_movingav: 132.666667<br />region: Mid and East Antrim","rank_movingav:  34.000000<br />region: Mid and East Antrim",null,"rank_movingav: 103.666667<br />region: Mid Ulster","rank_movingav:  87.333333<br />region: Mid Ulster",null,"rank_movingav: 105.666667<br />region: Monmouthshire and Newport","rank_movingav: 104.666667<br />region: Monmouthshire and Newport",null,"rank_movingav:  19.666667<br />region: Na h-Eileanan Siar","rank_movingav:  51.666667<br />region: Na h-Eileanan Siar",null,"rank_movingav:  11.333333<br />region: Newry, Mourne and Down","rank_movingav:  17.666667<br />region: Newry, Mourne and Down",null,"rank_movingav:  52.000000<br />region: North Lanarkshire","rank_movingav:  86.000000<br />region: North Lanarkshire",null,"rank_movingav: 119.000000<br />region: Orkney Islands","rank_movingav: 108.000000<br />region: Orkney Islands",null,"rank_movingav: 119.000000<br />region: Perth and Kinross, and Stirling","rank_movingav: 128.666667<br />region: Perth and Kinross, and Stirling",null,"rank_movingav:  29.333333<br />region: Powys","rank_movingav:  18.333333<br />region: Powys",null,"rank_movingav:  72.333333<br />region: Scottish Borders","rank_movingav:  60.000000<br />region: Scottish Borders",null,"rank_movingav: 146.333333<br />region: Shetland Islands","rank_movingav: 155.333333<br />region: Shetland Islands",null,"rank_movingav:  70.666667<br />region: South Ayrshire","rank_movingav:  71.666667<br />region: South Ayrshire",null,"rank_movingav:  51.666667<br />region: South Lanarkshire","rank_movingav:  66.000000<br />region: South Lanarkshire",null,"rank_movingav:  23.333333<br />region: South West Wales","rank_movingav:  30.333333<br />region: South West Wales",null,"rank_movingav:  56.666667<br />region: Swansea","rank_movingav:  82.666667<br />region: Swansea",null,"rank_movingav: 117.000000<br />region: West Lothian","rank_movingav: 118.666667<br />region: West Lothian"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2,null,1,2],"y":[131,139,null,115.33333333333333,101,null,176,173,null,106.66666666666667,104.33333333333333,null,115.66666666666667,122.66666666666667,null,45,33.333333333333336,null,104,137.33333333333334,null,143.33333333333334,151.33333333333334,null,151.33333333333334,134,null,137,143.33333333333334,null,86.666666666666671,70.666666666666671,null,139,136,null,29.333333333333332,48.333333333333336,null,132.66666666666666,124.66666666666667,null,145.66666666666666,129.66666666666666,null,81.666666666666671,83,null,84.666666666666671,62.666666666666664,null,39.666666666666664,13,null,45,57.666666666666664,null,57,37,null,170.33333333333334,156.33333333333334,null,24.666666666666668,12.666666666666666,null,43,61.333333333333336,null,75,77.666666666666671,null,138.66666666666666,134,null,134,139.33333333333334,null,85,58.333333333333336,null,158,154,null,16,27.666666666666668,null,108.66666666666667,94.666666666666671,null,96.333333333333329,105.33333333333333,null,106.33333333333333,107,null,70.333333333333329,55.666666666666664,null,132.66666666666666,131.33333333333334,null,34.333333333333336,56.666666666666664,null,120,107.66666666666667,null,174.66666666666666,174,null,53.666666666666664,29.666666666666668,null,167.66666666666666,167.33333333333334,null,90,54.666666666666664,null,64,39.333333333333336,null,75.666666666666671,112.33333333333333,null,141.66666666666666,143.33333333333334,null,156,149,null,163.66666666666666,151.33333333333334,null,57.333333333333336,75,null,120.66666666666667,133.66666666666666,null,81.333333333333329,53.333333333333336,null,63.666666666666664,44,null,164.33333333333334,169,null,86.333333333333329,72.333333333333329,null,59.333333333333336,55.666666666666664,null,99.666666666666671,99.666666666666671,null,32,32,null,123.66666666666667,138.33333333333334,null,18.333333333333332,18,null,69.666666666666671,66,null,50,74.666666666666671,null,113.66666666666667,112.66666666666667,null,169,169,null,121.66666666666667,115.33333333333333,null,113.33333333333333,111,null,17,2,null,33.666666666666664,17.666666666666668,null,140.66666666666666,153,null,131.66666666666666,131.66666666666666,null,149.66666666666666,149.33333333333334,null,131,142,null,164.66666666666666,165.33333333333334,null,160.33333333333334,146,null,91,98.333333333333329,null,109.33333333333333,101,null,75.333333333333329,47.666666666666664,null,82.666666666666671,96.666666666666671],"text":["rank_movingav: 131.000000<br />region: Bath and North East Somerset, North Somerset and South Gloucestershire","rank_movingav: 139.000000<br />region: Bath and North East Somerset, North Somerset and South Gloucestershire",null,"rank_movingav: 115.333333<br />region: Bedford","rank_movingav: 101.000000<br />region: Bedford",null,"rank_movingav: 176.000000<br />region: Berkshire","rank_movingav: 173.000000<br />region: Berkshire",null,"rank_movingav: 106.666667<br />region: Birmingham","rank_movingav: 104.333333<br />region: Birmingham",null,"rank_movingav: 115.666667<br />region: Bournemouth, Christchurch and Poole","rank_movingav: 122.666667<br />region: Bournemouth, Christchurch and Poole",null,"rank_movingav:  45.000000<br />region: Breckland and South Norfolk","rank_movingav:  33.333333<br />region: Breckland and South Norfolk",null,"rank_movingav: 104.000000<br />region: Brighton and Hove","rank_movingav: 137.333333<br />region: Brighton and Hove",null,"rank_movingav: 143.333333<br />region: Bristol, City of","rank_movingav: 151.333333<br />region: Bristol, City of",null,"rank_movingav: 151.333333<br />region: Buckinghamshire CC","rank_movingav: 134.000000<br />region: Buckinghamshire CC",null,"rank_movingav: 137.000000<br />region: Cambridgeshire CC","rank_movingav: 143.333333<br />region: Cambridgeshire CC",null,"rank_movingav:  86.666667<br />region: Central Bedfordshire","rank_movingav:  70.666667<br />region: Central Bedfordshire",null,"rank_movingav: 139.000000<br />region: Central Hampshire","rank_movingav: 136.000000<br />region: Central Hampshire",null,"rank_movingav:  29.333333<br />region: Cornwall and Isles of Scilly","rank_movingav:  48.333333<br />region: Cornwall and Isles of Scilly",null,"rank_movingav: 132.666667<br />region: Coventry","rank_movingav: 124.666667<br />region: Coventry",null,"rank_movingav: 145.666667<br />region: Derby","rank_movingav: 129.666667<br />region: Derby",null,"rank_movingav:  81.666667<br />region: Devon CC","rank_movingav:  83.000000<br />region: Devon CC",null,"rank_movingav:  84.666667<br />region: Dorset","rank_movingav:  62.666667<br />region: Dorset",null,"rank_movingav:  39.666667<br />region: Dudley","rank_movingav:  13.000000<br />region: Dudley",null,"rank_movingav:  45.000000<br />region: East Derbyshire","rank_movingav:  57.666667<br />region: East Derbyshire",null,"rank_movingav:  57.000000<br />region: East Kent","rank_movingav:  37.000000<br />region: East Kent",null,"rank_movingav: 170.333333<br />region: East Surrey","rank_movingav: 156.333333<br />region: East Surrey",null,"rank_movingav:  24.666667<br />region: East Sussex CC","rank_movingav:  12.666667<br />region: East Sussex CC",null,"rank_movingav:  43.000000<br />region: Essex Haven Gateway","rank_movingav:  61.333333<br />region: Essex Haven Gateway",null,"rank_movingav:  75.000000<br />region: Essex Thames Gateway","rank_movingav:  77.666667<br />region: Essex Thames Gateway",null,"rank_movingav: 138.666667<br />region: Gloucestershire CC","rank_movingav: 134.000000<br />region: Gloucestershire CC",null,"rank_movingav: 134.000000<br />region: Heart of Essex","rank_movingav: 139.333333<br />region: Heart of Essex",null,"rank_movingav:  85.000000<br />region: Herefordshire, County of","rank_movingav:  58.333333<br />region: Herefordshire, County of",null,"rank_movingav: 158.000000<br />region: Hertfordshire CC","rank_movingav: 154.000000<br />region: Hertfordshire CC",null,"rank_movingav:  16.000000<br />region: Isle of Wight","rank_movingav:  27.666667<br />region: Isle of Wight",null,"rank_movingav: 108.666667<br />region: Kent Thames Gateway","rank_movingav:  94.666667<br />region: Kent Thames Gateway",null,"rank_movingav:  96.333333<br />region: Leicester","rank_movingav: 105.333333<br />region: Leicester",null,"rank_movingav: 106.333333<br />region: Leicestershire CC and Rutland","rank_movingav: 107.000000<br />region: Leicestershire CC and Rutland",null,"rank_movingav:  70.333333<br />region: Lincolnshire CC","rank_movingav:  55.666667<br />region: Lincolnshire CC",null,"rank_movingav: 132.666667<br />region: Luton","rank_movingav: 131.333333<br />region: Luton",null,"rank_movingav:  34.333333<br />region: Medway","rank_movingav:  56.666667<br />region: Medway",null,"rank_movingav: 120.000000<br />region: Mid Kent","rank_movingav: 107.666667<br />region: Mid Kent",null,"rank_movingav: 174.666667<br />region: Milton Keynes","rank_movingav: 174.000000<br />region: Milton Keynes",null,"rank_movingav:  53.666667<br />region: North and West Norfolk","rank_movingav:  29.666667<br />region: North and West Norfolk",null,"rank_movingav: 167.666667<br />region: North Hampshire","rank_movingav: 167.333333<br />region: North Hampshire",null,"rank_movingav:  90.000000<br />region: North Northamptonshire","rank_movingav:  54.666667<br />region: North Northamptonshire",null,"rank_movingav:  64.000000<br />region: North Nottinghamshire","rank_movingav:  39.333333<br />region: North Nottinghamshire",null,"rank_movingav:  75.666667<br />region: Norwich and East Norfolk","rank_movingav: 112.333333<br />region: Norwich and East Norfolk",null,"rank_movingav: 141.666667<br />region: Nottingham","rank_movingav: 143.333333<br />region: Nottingham",null,"rank_movingav: 156.000000<br />region: Oxfordshire CC","rank_movingav: 149.000000<br />region: Oxfordshire CC",null,"rank_movingav: 163.666667<br />region: Peterborough","rank_movingav: 151.333333<br />region: Peterborough",null,"rank_movingav:  57.333333<br />region: Plymouth","rank_movingav:  75.000000<br />region: Plymouth",null,"rank_movingav: 120.666667<br />region: Portsmouth","rank_movingav: 133.666667<br />region: Portsmouth",null,"rank_movingav:  81.333333<br />region: Sandwell","rank_movingav:  53.333333<br />region: Sandwell",null,"rank_movingav:  63.666667<br />region: Shropshire CC","rank_movingav:  44.000000<br />region: Shropshire CC",null,"rank_movingav: 164.333333<br />region: Solihull","rank_movingav: 169.000000<br />region: Solihull",null,"rank_movingav:  86.333333<br />region: Somerset CC","rank_movingav:  72.333333<br />region: Somerset CC",null,"rank_movingav:  59.333333<br />region: South and West Derbyshire","rank_movingav:  55.666667<br />region: South and West Derbyshire",null,"rank_movingav:  99.666667<br />region: South Hampshire","rank_movingav:  99.666667<br />region: South Hampshire",null,"rank_movingav:  32.000000<br />region: South Nottinghamshire","rank_movingav:  32.000000<br />region: South Nottinghamshire",null,"rank_movingav: 123.666667<br />region: Southampton","rank_movingav: 138.333333<br />region: Southampton",null,"rank_movingav:  18.333333<br />region: Southend-on-Sea","rank_movingav:  18.000000<br />region: Southend-on-Sea",null,"rank_movingav:  69.666667<br />region: Staffordshire CC","rank_movingav:  66.000000<br />region: Staffordshire CC",null,"rank_movingav:  50.000000<br />region: Stoke-on-Trent","rank_movingav:  74.666667<br />region: Stoke-on-Trent",null,"rank_movingav: 113.666667<br />region: Suffolk CC","rank_movingav: 112.666667<br />region: Suffolk CC",null,"rank_movingav: 169.000000<br />region: Swindon","rank_movingav: 169.000000<br />region: Swindon",null,"rank_movingav: 121.666667<br />region: Telford and Wrekin","rank_movingav: 115.333333<br />region: Telford and Wrekin",null,"rank_movingav: 113.333333<br />region: Thurrock","rank_movingav: 111.000000<br />region: Thurrock",null,"rank_movingav:  17.000000<br />region: Torbay","rank_movingav:   2.000000<br />region: Torbay",null,"rank_movingav:  33.666667<br />region: Walsall","rank_movingav:  17.666667<br />region: Walsall",null,"rank_movingav: 140.666667<br />region: Warwickshire CC","rank_movingav: 153.000000<br />region: Warwickshire CC",null,"rank_movingav: 131.666667<br />region: West Essex","rank_movingav: 131.666667<br />region: West Essex",null,"rank_movingav: 149.666667<br />region: West Kent","rank_movingav: 149.333333<br />region: West Kent",null,"rank_movingav: 131.000000<br />region: West Northamptonshire","rank_movingav: 142.000000<br />region: West Northamptonshire",null,"rank_movingav: 164.666667<br />region: West Surrey","rank_movingav: 165.333333<br />region: West Surrey",null,"rank_movingav: 160.333333<br />region: West Sussex (North East)","rank_movingav: 146.000000<br />region: West Sussex (North East)",null,"rank_movingav:  91.000000<br />region: West Sussex (South West)","rank_movingav:  98.333333<br />region: West Sussex (South West)",null,"rank_movingav: 109.333333<br />region: Wiltshire","rank_movingav: 101.000000<br />region: Wiltshire",null,"rank_movingav:  75.333333<br />region: Wolverhampton","rank_movingav:  47.666667<br />region: Wolverhampton",null,"rank_movingav:  82.666667<br />region: Worcestershire CC","rank_movingav:  96.666667<br />region: Worcestershire CC"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(112,112,112,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"y":[179,178,176,96.666666666666671,95.333333333333329,177,171.33333333333334,164,165,79.333333333333329,44,7.333333333333333,86,98.666666666666671,106.66666666666667,116,79,122.66666666666667,126,159,175],"text":["rank_movingav: 179.000000<br />region: Camden and City of London","rank_movingav: 178.000000<br />region: Westminster","rank_movingav: 176.000000<br />region: Kensington & Chelsea and Hammersmith & Fulham","rank_movingav:  96.666667<br />region: Wandsworth","rank_movingav:  95.333333<br />region: Hackney and Newham","rank_movingav: 177.000000<br />region: Tower Hamlets","rank_movingav: 171.333333<br />region: Haringey and Islington","rank_movingav: 164.000000<br />region: Lewisham and Southwark","rank_movingav: 165.000000<br />region: Lambeth","rank_movingav:  79.333333<br />region: Bexley and Greenwich","rank_movingav:  44.000000<br />region: Barking & Dagenham and Havering","rank_movingav:   7.333333<br />region: Redbridge and Waltham Forest","rank_movingav:  86.000000<br />region: Enfield","rank_movingav:  98.666667<br />region: Bromley","rank_movingav: 106.666667<br />region: Croydon","rank_movingav: 116.000000<br />region: Merton, Kingston upon Thames and Sutton","rank_movingav:  79.000000<br />region: Barnet","rank_movingav: 122.666667<br />region: Brent","rank_movingav: 126.000000<br />region: Ealing","rank_movingav: 159.000000<br />region: Harrow and Hillingdon","rank_movingav: 175.000000<br />region: Hounslow and Richmond upon Thames"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"y":[76.333333333333329,14.333333333333334,100.66666666666667,12.333333333333334,10.333333333333334,90.333333333333329,115,67.333333333333329,120.66666666666667,168.66666666666666,156,50,28.666666666666668,19.333333333333332,64.333333333333329,42,21,146.66666666666666,35.666666666666664,52.666666666666664,162,160.66666666666666,146.66666666666666,90.666666666666671,124.66666666666667,3.6666666666666665,7.333333333333333,84.333333333333329,53,91.666666666666671,139.33333333333334,103.66666666666667,31,151.33333333333334,46.666666666666664,77.666666666666671],"text":["rank_movingav:  76.333333<br />region: Hartlepool and Stockton-on-Tees","rank_movingav:  14.333333<br />region: South Teesside","rank_movingav: 100.666667<br />region: Darlington","rank_movingav:  12.333333<br />region: Durham CC","rank_movingav:  10.333333<br />region: Northumberland","rank_movingav:  90.333333<br />region: Tyneside","rank_movingav: 115.000000<br />region: Sunderland","rank_movingav:  67.333333<br />region: West Cumbria","rank_movingav: 120.666667<br />region: East Cumbria","rank_movingav: 168.666667<br />region: Manchester","rank_movingav: 156.000000<br />region: Greater Manchester South West","rank_movingav:  50.000000<br />region: Greater Manchester South East","rank_movingav:  28.666667<br />region: Greater Manchester North West","rank_movingav:  19.333333<br />region: Greater Manchester North East","rank_movingav:  64.333333<br />region: Blackburn with Darwen","rank_movingav:  42.000000<br />region: Blackpool","rank_movingav:  21.000000<br />region: Lancaster and Wyre","rank_movingav: 146.666667<br />region: Mid Lancashire","rank_movingav:  35.666667<br />region: East Lancashire","rank_movingav:  52.666667<br />region: Chorley and West Lancashire","rank_movingav: 162.000000<br />region: Warrington","rank_movingav: 160.666667<br />region: Cheshire East","rank_movingav: 146.666667<br />region: Cheshire West and Chester","rank_movingav:  90.666667<br />region: East Merseyside","rank_movingav: 124.666667<br />region: Liverpool","rank_movingav:   3.666667<br />region: Sefton","rank_movingav:   7.333333<br />region: Wirral","rank_movingav:  84.333333<br />region: Kingston upon Hull, City of","rank_movingav:  53.000000<br />region: East Riding of Yorkshire","rank_movingav:  91.666667<br />region: North and North East Lincolnshire","rank_movingav: 139.333333<br />region: York","rank_movingav: 103.666667<br />region: North Yorkshire CC","rank_movingav:  31.000000<br />region: Bradford","rank_movingav: 151.333333<br />region: Leeds","rank_movingav:  46.666667<br />region: Calderdale and Kirklees","rank_movingav:  77.666667<br />region: Wakefield"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"y":[5.333333333333333,44.333333333333336,20.666666666666668,30.333333333333332,23,6.666666666666667,43.666666666666664,82.666666666666671,104.66666666666667,130,120,18.333333333333332,157,70.666666666666671,125.66666666666667,107.33333333333333,51.666666666666664,108,155.33333333333334,65,47.333333333333336,19,171.66666666666666,107.33333333333333,128.66666666666666,118.66666666666667,20,157.66666666666666,38.333333333333336,86,60,95.666666666666671,8.3333333333333339,71.666666666666671,66,163.66666666666666,31.333333333333332,17.666666666666668,1,35.333333333333336,87.333333333333329,4,87.666666666666671,81.666666666666671,34,38],"text":["rank_movingav:   5.333333<br />region: Isle of Anglesey","rank_movingav:  44.333333<br />region: Gwynedd","rank_movingav:  20.666667<br />region: Conwy and Denbighshire","rank_movingav:  30.333333<br />region: South West Wales","rank_movingav:  23.000000<br />region: Central Valleys","rank_movingav:   6.666667<br />region: Gwent Valleys","rank_movingav:  43.666667<br />region: Bridgend and Neath Port Talbot","rank_movingav:  82.666667<br />region: Swansea","rank_movingav: 104.666667<br />region: Monmouthshire and Newport","rank_movingav: 130.000000<br />region: Cardiff and Vale of Glamorgan","rank_movingav: 120.000000<br />region: Flintshire and Wrexham","rank_movingav:  18.333333<br />region: Powys","rank_movingav: 157.000000<br />region: Aberdeen City and Aberdeenshire","rank_movingav:  70.666667<br />region: Caithness and Sutherland, and Ross and Cromarty","rank_movingav: 125.666667<br />region: Inverness and Nairn, Moray, Badenoch and Strathspey","rank_movingav: 107.333333<br />region: Lochaber, Skye and Lochalsh, Arran and Cumbrae, and Argyll and Bute","rank_movingav:  51.666667<br />region: Na h-Eileanan Siar","rank_movingav: 108.000000<br />region: Orkney Islands","rank_movingav: 155.333333<br />region: Shetland Islands","rank_movingav:  65.000000<br />region: Angus and Dundee City","rank_movingav:  47.333333<br />region: Clackmannanshire and Fife","rank_movingav:  19.000000<br />region: East Lothian and Midlothian","rank_movingav: 171.666667<br />region: City of Edinburgh","rank_movingav: 107.333333<br />region: Falkirk","rank_movingav: 128.666667<br />region: Perth and Kinross, and Stirling","rank_movingav: 118.666667<br />region: West Lothian","rank_movingav:  20.000000<br />region: East Dunbartonshire, West Dunbartonshire, and Helensburgh and Lomond","rank_movingav: 157.666667<br />region: Glasgow City","rank_movingav:  38.333333<br />region: Inverclyde, East Renfrewshire, and Renfrewshire","rank_movingav:  86.000000<br />region: North Lanarkshire","rank_movingav:  60.000000<br />region: Scottish Borders","rank_movingav:  95.666667<br />region: Dumfries and Galloway","rank_movingav:   8.333333<br />region: East Ayrshire and North Ayrshire mainland","rank_movingav:  71.666667<br />region: South Ayrshire","rank_movingav:  66.000000<br />region: South Lanarkshire","rank_movingav: 163.666667<br />region: Belfast","rank_movingav:  31.333333<br />region: Armagh City, Banbridge and Craigavon","rank_movingav:  17.666667<br />region: Newry, Mourne and Down","rank_movingav:   1.000000<br />region: Ards and North Down","rank_movingav:  35.333333<br />region: Derry City and Strabane","rank_movingav:  87.333333<br />region: Mid Ulster","rank_movingav:   4.000000<br />region: Causeway Coast and Glens","rank_movingav:  87.666667<br />region: Antrim and Newtownabbey","rank_movingav:  81.666667<br />region: Lisburn and Castlereagh","rank_movingav:  34.000000<br />region: Mid and East Antrim","rank_movingav:  38.000000<br />region: Fermanagh and Omagh"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"y":[129.66666666666666,57.666666666666664,55.666666666666664,143.33333333333334,39.333333333333336,32,105.33333333333333,107,142,54.666666666666664,55.666666666666664,58.333333333333336,96.666666666666671,153,115.33333333333333,44,74.666666666666671,66,104.33333333333333,169,124.66666666666667,13,53.333333333333336,17.666666666666668,47.666666666666664,151.33333333333334,143.33333333333334,112.66666666666667,112.33333333333333,29.666666666666668,33.333333333333336,131.33333333333334,154,101,70.666666666666671,18,111,61.333333333333336,131.66666666666666,139.33333333333334,77.666666666666671,173,174,134,149,137.33333333333334,12.666666666666666,165.33333333333334,156.33333333333334,98.333333333333329,146,133.66666666666666,138.33333333333334,27.666666666666668,99.666666666666671,136,167.33333333333334,56.666666666666664,94.666666666666671,37,107.66666666666667,149.33333333333334,151.33333333333334,139,134,169,101,72.333333333333329,122.66666666666667,62.666666666666664,48.333333333333336,75,2,83],"text":["rank_movingav: 129.666667<br />region: Derby","rank_movingav:  57.666667<br />region: East Derbyshire","rank_movingav:  55.666667<br />region: South and West Derbyshire","rank_movingav: 143.333333<br />region: Nottingham","rank_movingav:  39.333333<br />region: North Nottinghamshire","rank_movingav:  32.000000<br />region: South Nottinghamshire","rank_movingav: 105.333333<br />region: Leicester","rank_movingav: 107.000000<br />region: Leicestershire CC and Rutland","rank_movingav: 142.000000<br />region: West Northamptonshire","rank_movingav:  54.666667<br />region: North Northamptonshire","rank_movingav:  55.666667<br />region: Lincolnshire CC","rank_movingav:  58.333333<br />region: Herefordshire, County of","rank_movingav:  96.666667<br />region: Worcestershire CC","rank_movingav: 153.000000<br />region: Warwickshire CC","rank_movingav: 115.333333<br />region: Telford and Wrekin","rank_movingav:  44.000000<br />region: Shropshire CC","rank_movingav:  74.666667<br />region: Stoke-on-Trent","rank_movingav:  66.000000<br />region: Staffordshire CC","rank_movingav: 104.333333<br />region: Birmingham","rank_movingav: 169.000000<br />region: Solihull","rank_movingav: 124.666667<br />region: Coventry","rank_movingav:  13.000000<br />region: Dudley","rank_movingav:  53.333333<br />region: Sandwell","rank_movingav:  17.666667<br />region: Walsall","rank_movingav:  47.666667<br />region: Wolverhampton","rank_movingav: 151.333333<br />region: Peterborough","rank_movingav: 143.333333<br />region: Cambridgeshire CC","rank_movingav: 112.666667<br />region: Suffolk CC","rank_movingav: 112.333333<br />region: Norwich and East Norfolk","rank_movingav:  29.666667<br />region: North and West Norfolk","rank_movingav:  33.333333<br />region: Breckland and South Norfolk","rank_movingav: 131.333333<br />region: Luton","rank_movingav: 154.000000<br />region: Hertfordshire CC","rank_movingav: 101.000000<br />region: Bedford","rank_movingav:  70.666667<br />region: Central Bedfordshire","rank_movingav:  18.000000<br />region: Southend-on-Sea","rank_movingav: 111.000000<br />region: Thurrock","rank_movingav:  61.333333<br />region: Essex Haven Gateway","rank_movingav: 131.666667<br />region: West Essex","rank_movingav: 139.333333<br />region: Heart of Essex","rank_movingav:  77.666667<br />region: Essex Thames Gateway","rank_movingav: 173.000000<br />region: Berkshire","rank_movingav: 174.000000<br />region: Milton Keynes","rank_movingav: 134.000000<br />region: Buckinghamshire CC","rank_movingav: 149.000000<br />region: Oxfordshire CC","rank_movingav: 137.333333<br />region: Brighton and Hove","rank_movingav:  12.666667<br />region: East Sussex CC","rank_movingav: 165.333333<br />region: West Surrey","rank_movingav: 156.333333<br />region: East Surrey","rank_movingav:  98.333333<br />region: West Sussex (South West)","rank_movingav: 146.000000<br />region: West Sussex (North East)","rank_movingav: 133.666667<br />region: Portsmouth","rank_movingav: 138.333333<br />region: Southampton","rank_movingav:  27.666667<br />region: Isle of Wight","rank_movingav:  99.666667<br />region: South Hampshire","rank_movingav: 136.000000<br />region: Central Hampshire","rank_movingav: 167.333333<br />region: North Hampshire","rank_movingav:  56.666667<br />region: Medway","rank_movingav:  94.666667<br />region: Kent Thames Gateway","rank_movingav:  37.000000<br />region: East Kent","rank_movingav: 107.666667<br />region: Mid Kent","rank_movingav: 149.333333<br />region: West Kent","rank_movingav: 151.333333<br />region: Bristol, City of","rank_movingav: 139.000000<br />region: Bath and North East Somerset, North Somerset and South Gloucestershire","rank_movingav: 134.000000<br />region: Gloucestershire CC","rank_movingav: 169.000000<br />region: Swindon","rank_movingav: 101.000000<br />region: Wiltshire","rank_movingav:  72.333333<br />region: Somerset CC","rank_movingav: 122.666667<br />region: Bournemouth, Christchurch and Poole","rank_movingav:  62.666667<br />region: Dorset","rank_movingav:  48.333333<br />region: Cornwall and Isles of Scilly","rank_movingav:  75.000000<br />region: Plymouth","rank_movingav:   2.000000<br />region: Torbay","rank_movingav:  83.000000<br />region: Devon CC"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[2,2],"y":[26,74],"text":["rank_movingav:  26.000000<br />region: Barnsley, Doncaster and Rotherham","rank_movingav:  74.000000<br />region: Sheffield"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":22.677165354330711,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"y":[179,178,172.66666666666666,73.333333333333329,71,177,170.66666666666666,150.33333333333334,157.33333333333334,94.666666666666671,97.333333333333329,31,107,122.66666666666667,125.33333333333333,141,102.33333333333333,136.33333333333334,136.33333333333334,172.66666666666666,174],"text":["rank_movingav: 179.000000<br />region: Camden and City of London","rank_movingav: 178.000000<br />region: Westminster","rank_movingav: 172.666667<br />region: Kensington & Chelsea and Hammersmith & Fulham","rank_movingav:  73.333333<br />region: Wandsworth","rank_movingav:  71.000000<br />region: Hackney and Newham","rank_movingav: 177.000000<br />region: Tower Hamlets","rank_movingav: 170.666667<br />region: Haringey and Islington","rank_movingav: 150.333333<br />region: Lewisham and Southwark","rank_movingav: 157.333333<br />region: Lambeth","rank_movingav:  94.666667<br />region: Bexley and Greenwich","rank_movingav:  97.333333<br />region: Barking & Dagenham and Havering","rank_movingav:  31.000000<br />region: Redbridge and Waltham Forest","rank_movingav: 107.000000<br />region: Enfield","rank_movingav: 122.666667<br />region: Bromley","rank_movingav: 125.333333<br />region: Croydon","rank_movingav: 141.000000<br />region: Merton, Kingston upon Thames and Sutton","rank_movingav: 102.333333<br />region: Barnet","rank_movingav: 136.333333<br />region: Brent","rank_movingav: 136.333333<br />region: Ealing","rank_movingav: 172.666667<br />region: Harrow and Hillingdon","rank_movingav: 174.000000<br />region: Hounslow and Richmond upon Thames"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"y":[76.666666666666671,22.666666666666668,128,18,23,71.666666666666671,63,77,109.33333333333333,166,151.33333333333334,49.333333333333336,28.333333333333332,23,46.666666666666664,10.666666666666666,22.666666666666668,161.66666666666666,38.333333333333336,38,160.33333333333334,147,130.33333333333334,75.333333333333329,102.33333333333333,2,4.666666666666667,63.666666666666664,65.666666666666671,84.666666666666671,153.66666666666666,94,53,150.33333333333334,40.333333333333336,91.666666666666671],"text":["rank_movingav:  76.666667<br />region: Hartlepool and Stockton-on-Tees","rank_movingav:  22.666667<br />region: South Teesside","rank_movingav: 128.000000<br />region: Darlington","rank_movingav:  18.000000<br />region: Durham CC","rank_movingav:  23.000000<br />region: Northumberland","rank_movingav:  71.666667<br />region: Tyneside","rank_movingav:  63.000000<br />region: Sunderland","rank_movingav:  77.000000<br />region: West Cumbria","rank_movingav: 109.333333<br />region: East Cumbria","rank_movingav: 166.000000<br />region: Manchester","rank_movingav: 151.333333<br />region: Greater Manchester South West","rank_movingav:  49.333333<br />region: Greater Manchester South East","rank_movingav:  28.333333<br />region: Greater Manchester North West","rank_movingav:  23.000000<br />region: Greater Manchester North East","rank_movingav:  46.666667<br />region: Blackburn with Darwen","rank_movingav:  10.666667<br />region: Blackpool","rank_movingav:  22.666667<br />region: Lancaster and Wyre","rank_movingav: 161.666667<br />region: Mid Lancashire","rank_movingav:  38.333333<br />region: East Lancashire","rank_movingav:  38.000000<br />region: Chorley and West Lancashire","rank_movingav: 160.333333<br />region: Warrington","rank_movingav: 147.000000<br />region: Cheshire East","rank_movingav: 130.333333<br />region: Cheshire West and Chester","rank_movingav:  75.333333<br />region: East Merseyside","rank_movingav: 102.333333<br />region: Liverpool","rank_movingav:   2.000000<br />region: Sefton","rank_movingav:   4.666667<br />region: Wirral","rank_movingav:  63.666667<br />region: Kingston upon Hull, City of","rank_movingav:  65.666667<br />region: East Riding of Yorkshire","rank_movingav:  84.666667<br />region: North and North East Lincolnshire","rank_movingav: 153.666667<br />region: York","rank_movingav:  94.000000<br />region: North Yorkshire CC","rank_movingav:  53.000000<br />region: Bradford","rank_movingav: 150.333333<br />region: Leeds","rank_movingav:  40.333333<br />region: Calderdale and Kirklees","rank_movingav:  91.666667<br />region: Wakefield"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"y":[3.6666666666666665,43.666666666666664,12,23.333333333333332,8,8.3333333333333339,50,56.666666666666664,105.66666666666667,121,103.33333333333333,29.333333333333332,155.66666666666666,52,100,54,19.666666666666668,119,146.33333333333334,49.333333333333336,39.333333333333336,5.666666666666667,166.66666666666666,109,119,117,4,157.66666666666666,33,52,72.333333333333329,92.333333333333329,13.333333333333334,70.666666666666671,51.666666666666664,150,26.666666666666668,11.333333333333334,1,12,103.66666666666667,11.333333333333334,88.666666666666671,67.333333333333329,132.66666666666666,38],"text":["rank_movingav:   3.666667<br />region: Isle of Anglesey","rank_movingav:  43.666667<br />region: Gwynedd","rank_movingav:  12.000000<br />region: Conwy and Denbighshire","rank_movingav:  23.333333<br />region: South West Wales","rank_movingav:   8.000000<br />region: Central Valleys","rank_movingav:   8.333333<br />region: Gwent Valleys","rank_movingav:  50.000000<br />region: Bridgend and Neath Port Talbot","rank_movingav:  56.666667<br />region: Swansea","rank_movingav: 105.666667<br />region: Monmouthshire and Newport","rank_movingav: 121.000000<br />region: Cardiff and Vale of Glamorgan","rank_movingav: 103.333333<br />region: Flintshire and Wrexham","rank_movingav:  29.333333<br />region: Powys","rank_movingav: 155.666667<br />region: Aberdeen City and Aberdeenshire","rank_movingav:  52.000000<br />region: Caithness and Sutherland, and Ross and Cromarty","rank_movingav: 100.000000<br />region: Inverness and Nairn, Moray, Badenoch and Strathspey","rank_movingav:  54.000000<br />region: Lochaber, Skye and Lochalsh, Arran and Cumbrae, and Argyll and Bute","rank_movingav:  19.666667<br />region: Na h-Eileanan Siar","rank_movingav: 119.000000<br />region: Orkney Islands","rank_movingav: 146.333333<br />region: Shetland Islands","rank_movingav:  49.333333<br />region: Angus and Dundee City","rank_movingav:  39.333333<br />region: Clackmannanshire and Fife","rank_movingav:   5.666667<br />region: East Lothian and Midlothian","rank_movingav: 166.666667<br />region: City of Edinburgh","rank_movingav: 109.000000<br />region: Falkirk","rank_movingav: 119.000000<br />region: Perth and Kinross, and Stirling","rank_movingav: 117.000000<br />region: West Lothian","rank_movingav:   4.000000<br />region: East Dunbartonshire, West Dunbartonshire, and Helensburgh and Lomond","rank_movingav: 157.666667<br />region: Glasgow City","rank_movingav:  33.000000<br />region: Inverclyde, East Renfrewshire, and Renfrewshire","rank_movingav:  52.000000<br />region: North Lanarkshire","rank_movingav:  72.333333<br />region: Scottish Borders","rank_movingav:  92.333333<br />region: Dumfries and Galloway","rank_movingav:  13.333333<br />region: East Ayrshire and North Ayrshire mainland","rank_movingav:  70.666667<br />region: South Ayrshire","rank_movingav:  51.666667<br />region: South Lanarkshire","rank_movingav: 150.000000<br />region: Belfast","rank_movingav:  26.666667<br />region: Armagh City, Banbridge and Craigavon","rank_movingav:  11.333333<br />region: Newry, Mourne and Down","rank_movingav:   1.000000<br />region: Ards and North Down","rank_movingav:  12.000000<br />region: Derry City and Strabane","rank_movingav: 103.666667<br />region: Mid Ulster","rank_movingav:  11.333333<br />region: Causeway Coast and Glens","rank_movingav:  88.666667<br />region: Antrim and Newtownabbey","rank_movingav:  67.333333<br />region: Lisburn and Castlereagh","rank_movingav: 132.666667<br />region: Mid and East Antrim","rank_movingav:  38.000000<br />region: Fermanagh and Omagh"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x3","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"y":[145.66666666666666,45,59.333333333333336,141.66666666666666,64,32,96.333333333333329,106.33333333333333,131,90,70.333333333333329,85,82.666666666666671,140.66666666666666,121.66666666666667,63.666666666666664,50,69.666666666666671,106.66666666666667,164.33333333333334,132.66666666666666,39.666666666666664,81.333333333333329,33.666666666666664,75.333333333333329,163.66666666666666,137,113.66666666666667,75.666666666666671,53.666666666666664,45,132.66666666666666,158,115.33333333333333,86.666666666666671,18.333333333333332,113.33333333333333,43,131.66666666666666,134,75,176,174.66666666666666,151.33333333333334,156,104,24.666666666666668,164.66666666666666,170.33333333333334,91,160.33333333333334,120.66666666666667,123.66666666666667,16,99.666666666666671,139,167.66666666666666,34.333333333333336,108.66666666666667,57,120,149.66666666666666,143.33333333333334,131,138.66666666666666,169,109.33333333333333,86.333333333333329,115.66666666666667,84.666666666666671,29.333333333333332,57.333333333333336,17,81.666666666666671],"text":["rank_movingav: 145.666667<br />region: Derby","rank_movingav:  45.000000<br />region: East Derbyshire","rank_movingav:  59.333333<br />region: South and West Derbyshire","rank_movingav: 141.666667<br />region: Nottingham","rank_movingav:  64.000000<br />region: North Nottinghamshire","rank_movingav:  32.000000<br />region: South Nottinghamshire","rank_movingav:  96.333333<br />region: Leicester","rank_movingav: 106.333333<br />region: Leicestershire CC and Rutland","rank_movingav: 131.000000<br />region: West Northamptonshire","rank_movingav:  90.000000<br />region: North Northamptonshire","rank_movingav:  70.333333<br />region: Lincolnshire CC","rank_movingav:  85.000000<br />region: Herefordshire, County of","rank_movingav:  82.666667<br />region: Worcestershire CC","rank_movingav: 140.666667<br />region: Warwickshire CC","rank_movingav: 121.666667<br />region: Telford and Wrekin","rank_movingav:  63.666667<br />region: Shropshire CC","rank_movingav:  50.000000<br />region: Stoke-on-Trent","rank_movingav:  69.666667<br />region: Staffordshire CC","rank_movingav: 106.666667<br />region: Birmingham","rank_movingav: 164.333333<br />region: Solihull","rank_movingav: 132.666667<br />region: Coventry","rank_movingav:  39.666667<br />region: Dudley","rank_movingav:  81.333333<br />region: Sandwell","rank_movingav:  33.666667<br />region: Walsall","rank_movingav:  75.333333<br />region: Wolverhampton","rank_movingav: 163.666667<br />region: Peterborough","rank_movingav: 137.000000<br />region: Cambridgeshire CC","rank_movingav: 113.666667<br />region: Suffolk CC","rank_movingav:  75.666667<br />region: Norwich and East Norfolk","rank_movingav:  53.666667<br />region: North and West Norfolk","rank_movingav:  45.000000<br />region: Breckland and South Norfolk","rank_movingav: 132.666667<br />region: Luton","rank_movingav: 158.000000<br />region: Hertfordshire CC","rank_movingav: 115.333333<br />region: Bedford","rank_movingav:  86.666667<br />region: Central Bedfordshire","rank_movingav:  18.333333<br />region: Southend-on-Sea","rank_movingav: 113.333333<br />region: Thurrock","rank_movingav:  43.000000<br />region: Essex Haven Gateway","rank_movingav: 131.666667<br />region: West Essex","rank_movingav: 134.000000<br />region: Heart of Essex","rank_movingav:  75.000000<br />region: Essex Thames Gateway","rank_movingav: 176.000000<br />region: Berkshire","rank_movingav: 174.666667<br />region: Milton Keynes","rank_movingav: 151.333333<br />region: Buckinghamshire CC","rank_movingav: 156.000000<br />region: Oxfordshire CC","rank_movingav: 104.000000<br />region: Brighton and Hove","rank_movingav:  24.666667<br />region: East Sussex CC","rank_movingav: 164.666667<br />region: West Surrey","rank_movingav: 170.333333<br />region: East Surrey","rank_movingav:  91.000000<br />region: West Sussex (South West)","rank_movingav: 160.333333<br />region: West Sussex (North East)","rank_movingav: 120.666667<br />region: Portsmouth","rank_movingav: 123.666667<br />region: Southampton","rank_movingav:  16.000000<br />region: Isle of Wight","rank_movingav:  99.666667<br />region: South Hampshire","rank_movingav: 139.000000<br />region: Central Hampshire","rank_movingav: 167.666667<br />region: North Hampshire","rank_movingav:  34.333333<br />region: Medway","rank_movingav: 108.666667<br />region: Kent Thames Gateway","rank_movingav:  57.000000<br />region: East Kent","rank_movingav: 120.000000<br />region: Mid Kent","rank_movingav: 149.666667<br />region: West Kent","rank_movingav: 143.333333<br />region: Bristol, City of","rank_movingav: 131.000000<br />region: Bath and North East Somerset, North Somerset and South Gloucestershire","rank_movingav: 138.666667<br />region: Gloucestershire CC","rank_movingav: 169.000000<br />region: Swindon","rank_movingav: 109.333333<br />region: Wiltshire","rank_movingav:  86.333333<br />region: Somerset CC","rank_movingav: 115.666667<br />region: Bournemouth, Christchurch and Poole","rank_movingav:  84.666667<br />region: Dorset","rank_movingav:  29.333333<br />region: Cornwall and Isles of Scilly","rank_movingav:  57.333333<br />region: Plymouth","rank_movingav:  17.000000<br />region: Torbay","rank_movingav:  81.666667<br />region: Devon CC"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":7.559055118110237,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x4","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,1],"y":[16.666666666666668,73.666666666666671],"text":["rank_movingav:  16.666667<br />region: Barnsley, Doncaster and Rotherham","rank_movingav:  73.666667<br />region: Sheffield"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":22.677165354330711,"symbol":"triangle-up","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":37.917808219178085,"r":7.3059360730593621,"b":40.182648401826491,"l":43.105022831050235},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,0.24592302674494454],"automargin":true,"type":"linear","autorange":false,"range":[0.40000000000000002,2.6000000000000001],"tickmode":"array","ticktext":["1999","2018"],"tickvals":[1,2],"categoryorder":"array","categoryarray":["1999","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"annotations":[{"text":"year (average centre)","x":0.5,"y":0,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"top","annotationType":"axis","yshift":-21.917808219178088},{"text":"rank (3 year average)","x":0,"y":0.5,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xref":"paper","yref":"paper","textangle":-90,"xanchor":"right","yanchor":"center","annotationType":"axis","xshift":-27.762557077625573},{"text":"London","x":0.12296151337247227,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.68949771689498},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"North England","x":0.375,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.68949771689498},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"rest of UK","x":0.625,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.68949771689498},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"},{"text":"South Eng (exc. London)","x":0.8770384866275277,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(26,26,26,1)","family":"","size":11.68949771689498},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"center","yanchor":"bottom"}],"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-7.9000000000000004,187.90000000000001],"tickmode":"array","ticktext":["0","50","100","150"],"tickvals":[-8.8817841970012523e-16,50.000000000000007,100,150],"categoryorder":"array","categoryarray":["0","50","100","150"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.24592302674494454,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":0.24592302674494454,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.25407697325505546,"x1":0.49592302674494454,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.25407697325505546,"x1":0.49592302674494454,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.5040769732550554,"x1":0.7459230267449446,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.5040769732550554,"x1":0.7459230267449446,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"},{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.7540769732550554,"x1":1,"y0":0,"y1":1},{"type":"rect","fillcolor":"rgba(217,217,217,1)","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0.7540769732550554,"x1":1,"y0":0,"y1":23.37899543378996,"yanchor":1,"ysizemode":"pixel"}],"xaxis2":{"type":"linear","autorange":false,"range":[0.40000000000000002,2.6000000000000001],"tickmode":"array","ticktext":["1999","2018"],"tickvals":[1,2],"categoryorder":"array","categoryarray":["1999","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.25407697325505546,0.49592302674494454],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"xaxis3":{"type":"linear","autorange":false,"range":[0.40000000000000002,2.6000000000000001],"tickmode":"array","ticktext":["1999","2018"],"tickvals":[1,2],"categoryorder":"array","categoryarray":["1999","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.5040769732550554,0.7459230267449446],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"xaxis4":{"type":"linear","autorange":false,"range":[0.40000000000000002,2.6000000000000001],"tickmode":"array","ticktext":["1999","2018"],"tickvals":[1,2],"categoryorder":"array","categoryarray":["1999","2018"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"domain":[0.7540769732550554,1],"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":"","hoverformat":".2f"},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"15e6b7d4bbe55":{"x":{},"y":{},"colour":{},"type":"scatter"},"15e6b3c3a02b7":{"x":{},"y":{},"colour":{},"shape":{},"size":{}}},"cur_data":"15e6b7d4bbe55","visdat":{"15e6b7d4bbe55":["function (y) ","x"],"15e6b3c3a02b7":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Proportion diffs for ITL3 GVA per capita</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#For region grouping... Weight averages by population</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>weightedaverages.gva.cp.itl3.regions <span class="ot">&lt;-</span> gva.cp.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region_grouping =</span> ns_england_restofUK_londonseparate) <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_grouping,year) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">weighted_mean_gva =</span> <span class="fu">weighted.mean</span>(gva_per_capita, personcount, <span class="at">na.rm=</span>T)<span class="co">#get weighted average by each ITL2 grouping</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co">#merge in SY values</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(gva.cp.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">'Sheffield'</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">Sheffield_gva =</span> gva_per_capita), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(gva.cp.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">x =</span> region, <span class="at">pattern =</span> <span class="st">'Barnsley'</span>, <span class="at">ignore.case =</span> T)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">BDR_gva =</span> gva_per_capita), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>)) </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Repeat for core cities exc Sheffield</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>weightedaverages.gva.cp.itl3.cores <span class="ot">&lt;-</span> gva.cp.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">region_grouping =</span> core_cities_minus_sheffield) <span class="sc">%&gt;%</span> </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_grouping,year) <span class="sc">%&gt;%</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">weighted_mean_gva =</span> <span class="fu">weighted.mean</span>(gva_per_capita, personcount, <span class="at">na.rm=</span>T)<span class="co">#get weighted average by each ITL2 grouping</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="co">#merge in SY values</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(gva.cp.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">'Sheffield'</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">Sheffield_gva =</span> gva_per_capita), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(gva.cp.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">x =</span> region, <span class="at">pattern =</span> <span class="st">'Barnsley'</span>, <span class="at">ignore.case =</span> T)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, <span class="at">BDR_gva =</span> gva_per_capita), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'year'</span>)) </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Append those two</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>weightedavs.gva.cp.itl3 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  weightedaverages.gva.cp.itl3.regions,</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  weightedaverages.gva.cp.itl3.cores <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region_grouping<span class="sc">!=</span><span class="st">'Other'</span>)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Make Sheffield and BDR gva long, and find proportion diffs</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>weightedavs.gva.cp.itl3 <span class="ot">&lt;-</span> weightedavs.gva.cp.itl3 <span class="sc">%&gt;%</span> </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> Sheffield_gva<span class="sc">:</span>BDR_gva, <span class="at">names_to =</span> <span class="st">'place'</span>, <span class="at">values_to =</span> <span class="st">'gva'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff =</span> (weighted_mean_gva <span class="sc">-</span> gva)<span class="sc">/</span>gva</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_grouping,place) <span class="sc">%&gt;%</span> </span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_3yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_5yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">5</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="co">#Plain prop diff looks smoothed already I think... </span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(weightedavs.gva.cp.itl3, aes(x = year, y = prop_diff * 100, colour = region_grouping)) +</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weightedavs.gva.cp.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region_grouping<span class="sc">!=</span><span class="st">'London'</span>), <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop_diff <span class="sc">*</span> <span class="dv">100</span>, <span class="at">colour =</span> region_grouping)) <span class="sc">+</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(weightedavs.itl3 %&gt;% filter(region_grouping!='London', !is.na(prop_diff_5yrsmooth)), aes(x = year, y = prop_diff_5yrsmooth * 100, colour = region_grouping)) +</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(weightedavs.itl3, aes(x = year, y = prop_diff * 100, colour = region_grouping)) +</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_cartesian(ylim = c(-1,30)) +</span></span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>place)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="gdp_gaps_files/figure-html/prop_diffsITL3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#VERSION TO DIRECTLY COMPARE SHEFFIELD TO OTHER 'CORE CITIES'</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Exclude Sheffield, as we want % diff for Sheffield, will add as own column</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Don't need hours per week as using direct GVA comparison, no need for weighted av</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>comparator <span class="ot">=</span> <span class="st">'Sheffield'</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># comparator = 'Manchester'</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># comparator = 'Leeds'</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># comparator = 'Nottingham'</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>corecompare <span class="ot">&lt;-</span> gva.cp.itl3 <span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, year, gva_per_capita) <span class="sc">%&gt;%</span> </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> corecities[corecities<span class="sc">!=</span>comparator]) <span class="sc">%&gt;%</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    gva.cp.itl3 <span class="sc">%&gt;%</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(region <span class="sc">==</span> comparator) <span class="sc">%&gt;%</span> </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(year, <span class="at">sheffield_gva =</span> gva_per_capita),</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">'year'</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_diff =</span> (gva_per_capita <span class="sc">-</span> sheffield_gva)<span class="sc">/</span>sheffield_gva) <span class="sc">%&gt;%</span> </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span> </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_3yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">3</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_diff_5yrsmooth =</span> <span class="fu">rollapply</span>(prop_diff,<span class="dv">5</span>,mean,<span class="at">align=</span><span class="st">'center'</span>,<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(corecompare, aes(x = year, y = prop_diff_5yrsmooth * 100, colour = fct_reorder(region, prop_diff_5yrsmooth))) +</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(corecompare, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop_diff <span class="sc">*</span> <span class="dv">100</span>, <span class="at">colour =</span> <span class="fu">fct_reorder</span>(region, prop_diff))) <span class="sc">+</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_cartesian(ylim = c(-1,30)) +</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">'Paired'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="gdp_gaps_files/figure-html/prop_diffsITL3-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Just look at Manc / Sheffield raw</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(gva.cp.itl3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Manchester'</span>,<span class="st">'Sheffield'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>